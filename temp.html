<script type="text/javascript">
  $(document).ready(function () {

    // Assign classes to elements based on URL name
    // If its redirected to cart page, reload elemnts
    var referrer = document.referrer;


    // Fix no design when referrer is order process

    var lem = $("#fullpage");
    var doc = lem[0].ownerDocument;

    var iframe = $(parent.document).find("iframe").filter(function () {
      return this.contentDocument === doc;
    });

    //window.frames["myframe"].location = "http://portals.iprintd.com/print/he-IL/cart/"

    /*
      referrer.includes("CheckoutFinal")
      */

    //window.frames["myframe"].location = "http://portals.iprintd.com/print/he-IL/cart/"



    var refLegacy = doc.location.href;
    var ref = window.location.href;
    if (refLegacy.includes("Cart")) {
      $("#ctl00_containerPageSubTitle").addClass("legacy-title-cart");
      if ($("#ctl00_cphMainContent_ucCurrentCart_lblEmptyCartMessage").length) {
        $(".ShoppingCartControl").addClass("empty-middle-cart");
        $("#ctl00_cphMainContent_ucCurrentCart_LblTitle").remove();
        $(".ShoppingCartControl:first").prepend("<img src='/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/no-shopping-cart.svg' id='empty-cart-img'></img>");
        $("#ctl00_cphMainContent_ucCurrentCart_lblEmptyCartMessage").text("אין לכם עדיין מוצרים בעגלה");
        $("#ctl00_cphMainContent_ucCurrentCart_btnContinueShopping").html("לכל המוצרים");
        $("#ctl00_cphMainContent_ucCurrentCart_btnContinueShopping").addClass("generic-orange-btn");
        $("#ctl00_cphMainContent_ucCurrentCart_lblEmptyCartMessage").addClass("empty-cart-msg");
      }

      if ($(".CheckOutPage").length) {
        $(".shoppingCart_selectAll_wrapper").remove();
        $(".CheckOutPage").each(function () {
          if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "");
          if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""));
        });
        $("#ctl00_cphMainContent_ucCurrentCart_LblTitle").remove();
        $("#ctl00_cphMainContent_BtnSubmit").addClass("generic-orange-btn");
        $(".ShoppingCartGrid_Column_Buttons").addClass("delete-box-legacy");
        $("#cartOrderTableWrapper").addClass("cart-box-legacy");
        $("#trShoppingCart").addClass("items-box-legacy");
        $("#CurrentCartSummary").addClass("total-box-legacy");
        $(".cart-box-legacy").prepend('<div id="products-header">מוצרים בעגלה</div>');
        $(".total-box-legacy .CheckOutPage").prepend('<div id="total-items-header">סיכום הזמנה</div>');
        $(".RadGrid_Default").addClass("cart-box-table-legacy");
        $(".thumbnailWrapper").addClass("cart-box-thumb-legacy");
        $(".rgMasterTable tbody").addClass("cart-box-tbody-legacy");
        $(".rgMasterTable tbody tr").each(function () {
          $(this).find(".ShoppingCartGrid_Column_Buttons:first").remove();
          if (this.innerText === '') {
            this.remove();
          }

          $(this).find(".divNickName").remove();
          $(this).find(".MoreInfoLabel").parent().remove();
          $(this).find(".editProduct .SiteLink").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/general-icons-edit.svg">');
          $(this).find(".ShoppingCartGrid_Column_Buttons a").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/general-icons-close.svg">');
          $(this).find(".priceHolder").append('<span class="include-tax">כולל מע"מ</span>');

          if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/סה"כ:/g, "");
          if (this.nodeType === 1) $(this).html($(this).html().replace(/סה"כ:/g, ""));

          if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/פריטים/g, "יחידות");
          if (this.nodeType === 1) $(this).html($(this).html().replace(/פריטים/g, "יחידות"));

          if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/פריט/g, "יחידה");
          if (this.nodeType === 1) $(this).html($(this).html().replace(/פריט/g, "יחידה"));

          if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/₪/g, "");
          if (this.nodeType === 1) $(this).html($(this).html().replace(/₪/g, ""));

          $(this).find(".BoldPriceLabel").append("₪");
        });

        var rowCount = $('.rgMasterTable >tbody >tr').length;
        $("#products-header").html("מוצרים בעגלה (" + rowCount + ")");
      }

      if ($(".empty-cart-msg").length) {
        $(".cart-box-legacy").remove();
        $(".items-box-legacy").css("width", "100%");
      }

      $("#CurrentCartSummary .panel li").each(function () {
        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/₪/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/₪/g, ""));
        $(this).find("dd span").append("₪");
      });

      $(".buttonContainer").each(function () {
        if (this.innerText === '') {
          this.remove();
        }

      });

    }

    // Personal settings 
    if (ref.includes("personal-information")) {
      setTimeout(function () {
        $("#ctl00_containerPageSubTitle").addClass("legacy-title-psettings");
        $("#trEditInfo").addClass("edit-settings-legacy");
        $("#trChangePassword").addClass("pass-settings-legacy");
        $(".edit-settings-legacy #trOptIn").remove();
        $(".edit-settings-legacy #trRequiredField").remove();
        $(".edit-settings-legacy td.FormLabel").remove();
        $(".pass-settings-legacy td.FormLabel").remove();
        $(".edit-settings-legacy #ctl00_cphMainContent_trCompanyName, .edit-settings-legacy #ctl00_cphMainContent_trDepartment,  .edit-settings-legacy #ctl00_cphMainContent_trJobTitle").remove();
        $(".edit-settings-legacy #ctl00_cphMainContent_trEmailAddress input").attr("placeholder", 'דוא"ל');
        $(".edit-settings-legacy #ctl00_cphMainContent_trFirstName input").attr("placeholder", "שם פרטי");
        $(".edit-settings-legacy #ctl00_cphMainContent_trLastName input").attr("placeholder", "שם משפחה");
        $(".edit-settings-legacy #ctl00_cphMainContent_trPhoneNumber input").attr("placeholder", "מספר פלאפון");
        var clonedEmail = $(".edit-settings-legacy #ctl00_cphMainContent_trEmailAddress").clone();
        $(".edit-settings-legacy #ctl00_cphMainContent_trEmailAddress").remove();
        clonedEmail.insertAfter(".edit-settings-legacy #ctl00_cphMainContent_trLastName");
        $('<div id="submit-changes-legacy"><a href="javascript:void(0);">עדכון פרטי חשבון</div></div>').insertAfter(".edit-settings-legacy #ctl00_cphMainContent_trPhoneNumber");
        $("#ctl00_cphMainContent_btnUpdate").hide();
        $(".pass-settings-legacy #ctl00_cphMainContent_txtOldPassword").attr("placeholder", "סיסמא נוכחית");
        $(".pass-settings-legacy #ctl00_cphMainContent_txtNewPassword").attr("placeholder", "סיסמא חדשה");
        $(".pass-settings-legacy #ctl00_cphMainContent_txtConfirmPassword").attr("placeholder", "אישור סיסמא חדשה");
        $(".pass-settings-legacy #ctl00_cphMainContent_txtConfirmPassword").closest("tr").addClass("last-tr-pass");
        $(".pass-settings-legacy .FormField").parent().addClass("pass-input-legacy");
        $(".pass-settings-legacy .FormField").parent().append('<div class="show-pass"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/pass-show.svg"></div>');
        $('<div id="submit-pass-legacy"><a href="javascript:void(0);">שינוי סיסמא</div></div>').insertAfter(".last-tr-pass");
        var clonedError = $(".ErrorText").clone();
        $(".ErrorText").remove();
        clonedError.insertAfter("#trButtons");
      }, 70);
      $(document).on("click", "#submit-changes-legacy a", function () {
        setTimeout(function () {
          $("#ctl00_cphMainContent_btnUpdate")[0].click();
        }, 400);
      });
      $(document).on("click", "#submit-pass-legacy a", function () {
        setTimeout(function () {
          $("#ctl00_cphMainContent_btnUpdate")[0].click();
        }, 400);
      });

      $(document).on("click", ".show-pass", function () {
        var input = $(this).parents(".pass-input-legacy").find(".FormField");
        //input.remove();
        console.log("clicked..");
        console.log(input);
        if (input.attr("type") == "password") {
          input.attr("type", "text");
        }
        else {
          input.attr("type", "password");
        }
      });


    }

    // Login / Register page
    if (ref.includes("login")) {
      setTimeout(function () {
        $("#divWebEnhancerButton").append('<div class="sheader"><div class="main-wrapper"><div class="sheader-stripe" draweropen="false"><div class="logo-wrapper"><a href="/print/he-IL/home/"><div class="logo-container"><img class="logo" src="/ustorethemes/GeneralPortalTheme//assets/images/logo.svg" alt="logo"></div></a></div><div id="order-icon"><a href="https://iprintd.copier.co.il" target="_blank"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="order-icon.svg" class="icon-image cart-icon"><defs><linearGradient id="order-icon_svg__a" x1="52.981%" x2="52.981%" y1="-187.061%" y2="407.127%"><stop offset="0%" stop-color="#FFC978"></stop><stop offset="100%" stop-color="#FB9A43"></stop></linearGradient></defs><path d="M16.223 20c.506 0 .953-.193 1.34-.58.386-.387.58-.834.58-1.34V4.063c0-.506-.194-.953-.58-1.34-.387-.387-.834-.58-1.34-.58H12.34a2.677 2.677 0 00-1.004-1.54A2.813 2.813 0 009.57 0c-.653 0-1.24.2-1.762.603-.52.401-.856.915-1.004 1.54H2.92c-.506 0-.953.193-1.34.58-.387.387-.58.834-.58 1.34V18.08c0 .506.193.953.58 1.34.387.387.834.58 1.34.58h13.303zM9.571 4.062a.876.876 0 01-.67-.29.986.986 0 01-.267-.692.914.914 0 01.938-.937.915.915 0 01.937.938c0 .267-.09.498-.268.691a.871.871 0 01-.67.29zm6.786 14.152H2.786V3.93H4.57v3.214h10V3.929h1.786v14.285z" fill="url(#order-icon_svg__a)" fill-rule="evenodd" class="cart-icon"></path></svg></div>הזמנת פלוטר לאדריכלים</a></div><div class="right-icons"><div class="sign-in-img"><div class="signin"><div class="signin-info"><div class="signin-title">החשבון שלי</div></div><div class="btn-container d-flex align-items-center"><a class="button-secondary"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="account-icon.svg" class="icon-image profile-icon"><path d="M10 10c1.389 0 2.57-.486 3.542-1.458C14.514 7.569 15 6.389 15 5c0-1.389-.486-2.57-1.458-3.542C12.569.486 11.389 0 10 0 8.611 0 7.43.486 6.458 1.458 5.486 2.431 5 3.611 5 5c0 1.389.486 2.57 1.458 3.542C7.431 9.514 8.611 10 10 10zm10 10v-2.5c0-1.493-1.146-2.7-3.438-3.62-2.291-.92-4.479-1.38-6.562-1.38s-4.27.469-6.563 1.406C1.147 14.81 0 16.006 0 17.5V20h20z" fill="#FFA351" fill-rule="evenodd" class="profile-icon"></path></svg></div></a></div></div></div><div class="cart"><a href="/print/he-IL/cart/"><div class="cart-icon-container"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="cart-icon.svg" class="icon-image cart-icon"><path d="M17.692 14.927v-1.951H6.25c-.16 0-.24-.082-.24-.244 0-.033.032-.13.096-.293l1.01-1.561h7.451c.802 0 1.379-.358 1.731-1.073l3.606-6.293A1.1 1.1 0 0020 3.024a.908.908 0 00-.313-.683.994.994 0 00-.697-.292H4.183L3.269 0H0v2.049h2.02l3.557 7.366-1.49 2.487c-.16.26-.24.586-.24.976 0 .65.2 1.155.6 1.512.4.358.922.537 1.563.537h11.682zM5.865 20a1.85 1.85 0 001.395-.61c.384-.406.577-.886.577-1.439s-.193-1.024-.577-1.414a1.89 1.89 0 00-1.395-.586c-.544 0-1.025.195-1.442.586-.385.39-.577.861-.577 1.414 0 .553.2 1.033.601 1.44.4.406.874.609 1.418.609zm9.808 0c.545 0 1.018-.203 1.418-.61.401-.406.601-.886.601-1.439s-.2-1.024-.6-1.414c-.401-.39-.874-.586-1.419-.586s-1.01.195-1.394.586c-.385.39-.577.861-.577 1.414 0 .553.192 1.033.577 1.44.384.406.85.609 1.394.609z" fill="#FFA351" fill-rule="evenodd" class="cart-icon"></path></svg></div></div></a></div></div></div></div></div>');
        $(".RegisterLink").parent().remove();
        $("#tblRegistration").addClass("register-block-legacy");
        $(".LoginMaster").addClass("login-page-legacy");
        $(".loginLogoContainer").remove();
        //var clonedFB = $(".login-page-legacy #tblSocialSignIn").clone();
        $(".login-page-legacy #tblSocialSignIn").hide();
        $(".login-page-legacy .control-label, .login-page-legacy .formpromptL").remove();
        $(".login-page-legacy #ctl00_cphMainContent_txtEmail").attr("placeholder", "מייל");
        $(".login-page-legacy #ctl00_cphMainContent_txtPassword").attr("placeholder", "סיסמה");
        $(".login-page-legacy #ctl00_cphMainContent_ucUserRegistration_txtFirstName").attr("placeholder", "שם פרטי");
        $(".login-page-legacy #ctl00_cphMainContent_ucUserRegistration_txtLastName").attr("placeholder", "שם משפחה (אופציונלי)");
        $(".login-page-legacy #ctl00_cphMainContent_ucUserRegistration_txtEmail").attr("placeholder", "מייל");
        $(".login-page-legacy #ctl00_cphMainContent_ucUserRegistration_txtPassword").attr("placeholder", "סיסמה");
        $(".login-page-legacy #ctl00_cphMainContent_ucUserRegistration_txtConfirmPassword").attr("placeholder", "אישור סיסמה");
        $(".login-page-legacy #ctl00_cphMainContent_emailRequired, .login-page-legacy #ctl00_cphMainContent_passwordRequired, .login-page-legacy #ctl00_cphMainContent_ucUserRegistration_rfvFirstName, .login-page-legacy #ctl00_cphMainContent_ucUserRegistration_rfvEmailAddress, .login-page-legacy #ctl00_cphMainContent_ucUserRegistration_rfvPassword, .login-page-legacy #ctl00_cphMainContent_emailValid").remove();
        $(".login-page-legacy #ctl00_cphMainContent_txtPassword, .login-page-legacy #ctl00_cphMainContent_ucUserRegistration_txtPassword, .login-page-legacy #ctl00_cphMainContent_ucUserRegistration_txtConfirmPassword").parent().append('<div class="show-pass"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/pass-show.svg"></div>');
        $(".login-page-legacy .formfield").addClass("FormField");
        $(".login-page-legacy .formdivider").remove();
        $(".sheader .signin-info").remove();
        $('<div class="fb-login-lgeacy"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/00-general-icons-facebook.svg">התחברות באמצעות Facebook</div>').insertAfter(".login-page-legacy #ctl00_cphMainContent_btnLogin");
        $('<div class="choose-or-legacy"><span class="or-legacy-title">או</span><span class="or-legacy-line"></span></div>').insertAfter('.login-page-legacy #tblSignIn');
      }, 70);
      $(document).on("click", ".show-pass", function () {
        var input = $(this).parent().find(".FormField");
        //input.remove();
        console.log("clicked..");
        console.log(input);
        if (input.attr("type") == "password") {
          input.attr("type", "text");
        }
        else {
          input.attr("type", "password");
        }
      });
      $(document).on("click", ".fb-login-lgeacy", function () {
        setTimeout(function () {
          $(".singleSignOnButtonFacebook")[0].click();
        }, 400);

      });

    }

    // Recover password page
    if (ref.includes("PasswordRecovery")) {
      $("#divWebEnhancerButton").append('<div class="sheader"><div class="main-wrapper"><div class="sheader-stripe" draweropen="false"><div class="logo-wrapper"><a href="/print/he-IL/home/"><div class="logo-container"><img class="logo" src="/ustorethemes/GeneralPortalTheme//assets/images/logo.svg" alt="logo"></div></a></div><div id="order-icon"><a href="https://iprintd.copier.co.il" target="_blank"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="order-icon.svg" class="icon-image cart-icon"><defs><linearGradient id="order-icon_svg__a" x1="52.981%" x2="52.981%" y1="-187.061%" y2="407.127%"><stop offset="0%" stop-color="#FFC978"></stop><stop offset="100%" stop-color="#FB9A43"></stop></linearGradient></defs><path d="M16.223 20c.506 0 .953-.193 1.34-.58.386-.387.58-.834.58-1.34V4.063c0-.506-.194-.953-.58-1.34-.387-.387-.834-.58-1.34-.58H12.34a2.677 2.677 0 00-1.004-1.54A2.813 2.813 0 009.57 0c-.653 0-1.24.2-1.762.603-.52.401-.856.915-1.004 1.54H2.92c-.506 0-.953.193-1.34.58-.387.387-.58.834-.58 1.34V18.08c0 .506.193.953.58 1.34.387.387.834.58 1.34.58h13.303zM9.571 4.062a.876.876 0 01-.67-.29.986.986 0 01-.267-.692.914.914 0 01.938-.937.915.915 0 01.937.938c0 .267-.09.498-.268.691a.871.871 0 01-.67.29zm6.786 14.152H2.786V3.93H4.57v3.214h10V3.929h1.786v14.285z" fill="url(#order-icon_svg__a)" fill-rule="evenodd" class="cart-icon"></path></svg></div>הזמנת פלוטר לאדריכלים</a></div><div class="right-icons"><div class="sign-in-img"><div class="signin"><div class="signin-info"><div class="signin-title">החשבון שלי</div></div><div class="btn-container d-flex align-items-center"><a class="button-secondary"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="account-icon.svg" class="icon-image profile-icon"><path d="M10 10c1.389 0 2.57-.486 3.542-1.458C14.514 7.569 15 6.389 15 5c0-1.389-.486-2.57-1.458-3.542C12.569.486 11.389 0 10 0 8.611 0 7.43.486 6.458 1.458 5.486 2.431 5 3.611 5 5c0 1.389.486 2.57 1.458 3.542C7.431 9.514 8.611 10 10 10zm10 10v-2.5c0-1.493-1.146-2.7-3.438-3.62-2.291-.92-4.479-1.38-6.562-1.38s-4.27.469-6.563 1.406C1.147 14.81 0 16.006 0 17.5V20h20z" fill="#FFA351" fill-rule="evenodd" class="profile-icon"></path></svg></div></a></div></div></div><div class="cart"><a href="/print/he-IL/cart/"><div class="cart-icon-container"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="cart-icon.svg" class="icon-image cart-icon"><path d="M17.692 14.927v-1.951H6.25c-.16 0-.24-.082-.24-.244 0-.033.032-.13.096-.293l1.01-1.561h7.451c.802 0 1.379-.358 1.731-1.073l3.606-6.293A1.1 1.1 0 0020 3.024a.908.908 0 00-.313-.683.994.994 0 00-.697-.292H4.183L3.269 0H0v2.049h2.02l3.557 7.366-1.49 2.487c-.16.26-.24.586-.24.976 0 .65.2 1.155.6 1.512.4.358.922.537 1.563.537h11.682zM5.865 20a1.85 1.85 0 001.395-.61c.384-.406.577-.886.577-1.439s-.193-1.024-.577-1.414a1.89 1.89 0 00-1.395-.586c-.544 0-1.025.195-1.442.586-.385.39-.577.861-.577 1.414 0 .553.2 1.033.601 1.44.4.406.874.609 1.418.609zm9.808 0c.545 0 1.018-.203 1.418-.61.401-.406.601-.886.601-1.439s-.2-1.024-.6-1.414c-.401-.39-.874-.586-1.419-.586s-1.01.195-1.394.586c-.385.39-.577.861-.577 1.414 0 .553.192 1.033.577 1.44.384.406.85.609 1.394.609z" fill="#FFA351" fill-rule="evenodd" class="cart-icon"></path></svg></div></div></a></div></div></div></div></div>');
      $(".sheader .signin-info").remove();
      $("#fullpage").addClass("recover-legacy-page");
      $(".recover-legacy-page #ctl00_cphMainContent_divPasswordRecovery").prepend('<div id="recover-header">שכחתם את הסיסמה?</div>');
      $(".recover-legacy-page #searcharea").remove();
      $(".recover-legacy-page #ctl00_cphMainContent_lblEmailAddress").parent().remove();
      $(".recover-legacy-page #ctl00_cphMainContent_lblExplain").parent().parent().remove();
      $(".recover-legacy-page #ctl00_cphMainContent_txtEmailAddress").attr("placeholder", "מייל");
      $(".recover-legacy-page #ctl00_cphMainContent_lblInstruct").html("צריך להזין את כתובת המייל שמשויכת לחשבון. אנחנו<span class='recover-instruct'>נשלח לך במייל קישור לאיפוס הסיסמה.</span>");
      $(".recover-legacy-page #ctl00_cphMainContent_divPasswordRecovery table tr").each(function () {
        if (this.innerText === ' ') {
          this.remove();
        }
      });
      $(".recover-legacy-page #ctl00_cphMainContent_btnContinue, .recover-legacy-page #ctl00_cphMainContent_btnBack1").parent().hide();
      $('<div class="recover-continue-btn">המשך</div><div class="recover-back-btn">חזרה להתחברות</div>').insertAfter('.recover-legacy-page #ctl00_cphMainContent_txtEmailAddress');
      $(document).on("click", ".recover-continue-btn", function () {
        setTimeout(function () {
          $("#ctl00_cphMainContent_btnContinue")[0].click();
        }, 400);
      });
      $(document).on("click", ".recover-back-btn", function () {
        setTimeout(function () {
          $("#ctl00_cphMainContent_btnBack1")[0].click();
        }, 400);
      });
      $(".recover-legacy-page #ctl00_cphMainContent_LblSuccessMsg").html("שים לב, המייל יישלח רק אם הוא נמצא ברשומות שלנו");
      $(".recover-legacy-page #ctl00_cphMainContent_btnBack").html("חזרה לדף הבית");
      $(".recover-legacy-page #ctl00_cphMainContent_divSuccess").prepend('<div id="title-forgot">קישור לאיפוס הסיסמה נשלח לכתובת המייל המשויכת לחשבון</div>');
      $(".recover-legacy-page #ctl00_cphMainContent_divPasswordReset").prepend('<div id="recover-header">איפוס סיסמה</div>');
      $(".recover-legacy-page #ctl00_cphMainContent_divPasswordReset .FormLabel").remove();
      $(".recover-legacy-page #ctl00_cphMainContent_txtNewPassword").attr("placeholder", "סיסמה חדשה");
      $(".recover-legacy-page #ctl00_cphMainContent_txtPasswordConfirm").attr("placeholder", "אישור סיסמה חדשה");
      $('<div class="recover-continue-btn">איפוס סיסמה</div>').insertAfter('.recover-legacy-page #ctl00_cphMainContent_txtPasswordConfirm');
      $(".recover-legacy-page .FormField").parent().append('<div class="show-pass"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/pass-show.svg"></div>');
      $(".recover-legacy-page #ctl00_cphMainContent_divPasswordReset .FormField").parent().addClass("recover-td");
      $(".recover-legacy-page .emailReminder").find(".show-pass").remove();
      $(document).on("click", ".show-pass", function () {
        var input = $(this).parent().find(".FormField");
        //input.remove();
        console.log("clicked..");
        console.log(input);
        if (input.attr("type") == "password") {
          input.attr("type", "text");
        }
        else {
          input.attr("type", "password");
        }
      });
    }

    // Order history page
    if (ref.includes("order-history")) {
      $("#fullpage").addClass("order-history-legacy");
      $(".order-history-legacy .toSmpSearchColumn").parent().remove();
      $(".order-history-legacy #trSearchFilter, .order-history-legacy #trShippingAddress, .order-history-legacy .captionColumn, .order-history-legacy #ctl00_cphMainContent_LblDateFrom, .order-history-legacy #ctl00_cphMainContent_LblDateTo").remove();
      $(".order-history-legacy #TxtOrderID2").attr("placeholder", "לדוגמא: 22795");
      $(".order-history-legacy #ctl00_cphMainContent_DtpFrom_dateInput").attr("placeholder", "מ-");
      $(".order-history-legacy #ctl00_cphMainContent_DtpTo_dateInput").attr("placeholder", "עד-");
      $(".order-history-legacy #tblAdvSearch tr:first").addClass("order-id");
      $(".order-history-legacy #TxtOrderID2").parent().prepend('<div class="order-title-legacy">מספר הזמנה</div>');
      $(".order-history-legacy #trDateRange .contentColumn").prepend('<div class="order-title-legacy">טווח תאריכים</div>');
      $(".order-history-legacy #trProduct .contentColumn").prepend('<div class="order-title-legacy">מוצר</div>');
      $(".order-history-legacy .rcCalPopup").parent().addClass("date-range-legacy");
      $(".order-history-legacy #divAdvSearch").prepend('<div class="order-search-title">איתור הזמנה</div>');
      $(".order-history-legacy #ctl00_cphMainContent_DtpFrom_dateInput").removeClass("riSingle");
      $(".order-history-legacy #ctl00_cphMainContent_DtpFrom_dateInput").removeClass("riTextBox");
      $(".order-history-legacy #ctl00_cphMainContent_ValCompareDates").parent().remove();
      $(".order-history-legacy #TxtProduct").attr("placeholder", "בחר מוצר");
      $(".order-history-legacy #BtnAdvSearch").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/search-order.svg">הצג הזמנות');
      $(".order-history-legacy #ctl00_cphMainContent_BtnClearSearch").html('נקה שדות');
      $(".order-history-legacy #ctl00_cphMainContent_BtnClearSearchResults").parent().remove();
      $(".order-history-legacy .orderListTable .paneSeparator").parent().remove();
      $(".order-history-legacy .rgMasterTable thead").remove();
      $(".rgMasterTable tbody tr").each(function () {
        $(this).find("td").eq(3).remove();

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""));

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/₪/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/₪/g, ""));
        $(this).find("td").eq(2).append("₪");
      });
      var rowCount = $('.rgMasterTable >tbody >tr').length;
      $(".order-history-legacy #ctl00_cphMainContent_LblListTitle").html("כל ההזמנות (" + rowCount + ")");
      $(".rgMasterTable tbody tr").each(function () {
        $(this).find("td").eq(0).append('<div class="order-explain">מספר הזמננה</div>');
        $(this).find("td").eq(1).append('<div class="order-explain">תאריך ההזמנה</div>');
        $(this).find("td").eq(2).append('<div class="order-explain">מחיר כולל מע"מ</div>');
        $(this).find("td").eq(3).prepend('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/order-link.svg">');
        $(this).find("td").eq(3).addClass("last-order-td");
      });
      /*
      $(".datePickerContainer .RadPicker").each (function () {
        $(document).on("click", $(this), function() {
          $(this).find(".rcCalPopup")[0].click();
        });
      });
      */
    }

    // General error page
    if (ref.includes("errorPage")) {
      $("#divWebEnhancerButton").append('<div class="sheader"><div class="main-wrapper"><div class="sheader-stripe" draweropen="false"><div class="logo-wrapper"><a href="/print/he-IL/home/"><div class="logo-container"><img class="logo" src="/ustorethemes/GeneralPortalTheme//assets/images/logo.svg" alt="logo"></div></a></div><div id="order-icon"><a href="https://iprintd.copier.co.il" target="_blank"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="order-icon.svg" class="icon-image cart-icon"><defs><linearGradient id="order-icon_svg__a" x1="52.981%" x2="52.981%" y1="-187.061%" y2="407.127%"><stop offset="0%" stop-color="#FFC978"></stop><stop offset="100%" stop-color="#FB9A43"></stop></linearGradient></defs><path d="M16.223 20c.506 0 .953-.193 1.34-.58.386-.387.58-.834.58-1.34V4.063c0-.506-.194-.953-.58-1.34-.387-.387-.834-.58-1.34-.58H12.34a2.677 2.677 0 00-1.004-1.54A2.813 2.813 0 009.57 0c-.653 0-1.24.2-1.762.603-.52.401-.856.915-1.004 1.54H2.92c-.506 0-.953.193-1.34.58-.387.387-.58.834-.58 1.34V18.08c0 .506.193.953.58 1.34.387.387.834.58 1.34.58h13.303zM9.571 4.062a.876.876 0 01-.67-.29.986.986 0 01-.267-.692.914.914 0 01.938-.937.915.915 0 01.937.938c0 .267-.09.498-.268.691a.871.871 0 01-.67.29zm6.786 14.152H2.786V3.93H4.57v3.214h10V3.929h1.786v14.285z" fill="url(#order-icon_svg__a)" fill-rule="evenodd" class="cart-icon"></path></svg></div>הזמנת פלוטר לאדריכלים</a></div><div class="right-icons"><div class="sign-in-img"><div class="signin"><div class="signin-info"><div class="signin-title">החשבון שלי</div></div><div class="btn-container d-flex align-items-center"><a class="button-secondary"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="account-icon.svg" class="icon-image profile-icon"><path d="M10 10c1.389 0 2.57-.486 3.542-1.458C14.514 7.569 15 6.389 15 5c0-1.389-.486-2.57-1.458-3.542C12.569.486 11.389 0 10 0 8.611 0 7.43.486 6.458 1.458 5.486 2.431 5 3.611 5 5c0 1.389.486 2.57 1.458 3.542C7.431 9.514 8.611 10 10 10zm10 10v-2.5c0-1.493-1.146-2.7-3.438-3.62-2.291-.92-4.479-1.38-6.562-1.38s-4.27.469-6.563 1.406C1.147 14.81 0 16.006 0 17.5V20h20z" fill="#FFA351" fill-rule="evenodd" class="profile-icon"></path></svg></div></a></div></div></div><div class="cart"><a href="/print/he-IL/cart/"><div class="cart-icon-container"><div class="icon icon-holder" style="width: 20px; height: 20px; background-size: 20px 20px;"><svg width="20px" height="20px" viewBox="0 0 20 20" name="cart-icon.svg" class="icon-image cart-icon"><path d="M17.692 14.927v-1.951H6.25c-.16 0-.24-.082-.24-.244 0-.033.032-.13.096-.293l1.01-1.561h7.451c.802 0 1.379-.358 1.731-1.073l3.606-6.293A1.1 1.1 0 0020 3.024a.908.908 0 00-.313-.683.994.994 0 00-.697-.292H4.183L3.269 0H0v2.049h2.02l3.557 7.366-1.49 2.487c-.16.26-.24.586-.24.976 0 .65.2 1.155.6 1.512.4.358.922.537 1.563.537h11.682zM5.865 20a1.85 1.85 0 001.395-.61c.384-.406.577-.886.577-1.439s-.193-1.024-.577-1.414a1.89 1.89 0 00-1.395-.586c-.544 0-1.025.195-1.442.586-.385.39-.577.861-.577 1.414 0 .553.2 1.033.601 1.44.4.406.874.609 1.418.609zm9.808 0c.545 0 1.018-.203 1.418-.61.401-.406.601-.886.601-1.439s-.2-1.024-.6-1.414c-.401-.39-.874-.586-1.419-.586s-1.01.195-1.394.586c-.385.39-.577.861-.577 1.414 0 .553.192 1.033.577 1.44.384.406.85.609 1.394.609z" fill="#FFA351" fill-rule="evenodd" class="cart-icon"></path></svg></div></div></a></div></div></div></div></div>');
      $(".sheader .signin-info").remove();
      $("#BodyTable").addClass("general-error-legacy");
      $('.general-error-legacy #ctl00_cphMainContent_LblErrorMessage').html("אנחנו מתנצלים על האי נוחות!");
      $('.general-error-legacy #ctl00_cphMainContent_BtnReturn').attr("value", "חזרה לחנות");
      $(".BoxStyle").prepend('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/warning.svg"><div class="heading-error-legacy">אופס, משהו השתבש</div>');
    }

    // Added JS From OLD checkout Functions //
    if (refLegacy.includes("CheckoutFinal")) {
      $(".cellbottom").hide();
      $(".mainAreaFooterFullWidth ").addClass("chk-hidden");
      $("#ctl00_cphMainContent_lblOrderDetails").hide();
      $("#searcharea").hide();
      $("#fullpage").prepend('<div id="purchase-timeline"><div id="line-bg"><div class="half-line-bg"></div><div class="half-line-bg"></div></div><div class="pstep ps-first active"><div class="ps-container"><div class="ps-circle"></div></div><span>פרטי לקוח</span></div><div class="pstep ps-second"><div class="ps-container"><div class="ps-circle"></div></div><span>פרטי משלוח</span></div><div class="pstep ps-third"><div class="ps-container"><div class="ps-circle"></div></div><span>סיכום הזמנה</span></div></div>');
      function validatePhone(txtPhone) {
        var a = document.getElementById(txtPhone).value;
        var filterM = /^05/g;
        var filter = /^(?:\+?\d{2}[ -]?\d{3}[ -]?\d{4}|\d{3})$/gm;
        var filterB = /^(?:\+?\d{3}[ -]?\d{3}[ -]?\d{4}|\d{3})$/gm;
        if (filterM.test(a)) {
          if (filterB.test(a)) {
            return true;
          }
          else {
            return false;
          }
        }
        else {
          if (filter.test(a)) {
            return true;
          }
          else {
            return false;
          }
        }

      }


      if ($("#ctl00_cphMainContent_lblOrderDetails").html() == "פרטי משלוח") {
        var fname = xmp.sdk.storeFrontParams.currentUser["firstName"];
        var lname = xmp.sdk.storeFrontParams.currentUser["lastName"];
        if (lname == "") { lname = ""; }
        var phone = xmp.sdk.storeFrontParams.currentUser["mobileNumber"];
        if (phone == "****") { phone = ""; }
        var bname = xmp.sdk.storeFrontParams.currentUser["custom2"];
        if (bname == "****") { bname = ""; }
        var bid = xmp.sdk.storeFrontParams.currentUser["custom1"];
        if (bid == "****") { bid = ""; }

        if ($(window).width() > 1216) {

          $('.mainareaFullWidth').prepend('<div id="details-full"><span class="details-error"></span><span class="boxHeading">פרטי הלקוח</span><div id="details-wrapper"><div class="details-form"><div class="ShippingItemContainer"><div><input type="text" placeholder="שם פרטי" id="fname" value="' + fname + '"><span class="input-err-desc"></span></div></div><div class="ShippingItemContainer"><div><input type="text" id="lname" placeholder="שם משפחה" value="' + lname + '"><span class="input-err-desc"></span></div></div><div class="ShippingItemContainer"><div><input type="text" id="phone" placeholder="טלפון סלולרי" value="' + phone + '"><span class="input-err-desc"></span></div></div></div><div class="checkbox"><span>במידה ופרטי הלקוח לחשבונית שונים מפרטים אלו</span><input type="checkbox" id="billingif"><label for="billingif" class="checker">&#8203;</label></div><div class="details-form" id="details-form-hidden"><div class="ShippingItemContainer"><div><input type="text" id="bname" placeholder="שם עבור חשבונית מס" value="' + bname + '"><span class="input-err-desc"></span></div></div><div class="ShippingItemContainer"><div><input type="text" id="bid" placeholder="מספר ח.פ" value="' + bid + '"><span class="input-err-desc"></span></div></div></div></div><div id="update-btn-client"><span id="update-msg"></span><a href="#">המשך לפרטי משלוח</a></div></div>');
        }
        else {
          $('.container').prepend('<div id="details-full"><span class="details-error"></span><span class="boxHeading">פרטי הלקוח</span><div id="details-wrapper"><div class="details-form"><div class="ShippingItemContainer"><span class="boxSubHeading"><strong>*</strong> שם פרטי:</span><div><input type="text" id="fname" value="' + fname + '"><span class="input-err-desc"></span></div></div><div class="ShippingItemContainer"><span class="boxSubHeading"><strong>*</strong> שם משפחה:</span><div><input type="text" id="lname" value="' + lname + '"><span class="input-err-desc"></span></div></div><div class="ShippingItemContainer"><span class="boxSubHeading"><strong>*</strong> טלפון סלולרי:</span><div><input type="text" id="phone" value="' + phone + '"><span class="input-err-desc"></span></div></div></div><label for="billingif">במידה ופרטי הלקוח לחשבונית שונים מפרטים אלו<input type="checkbox" id="billingif"></label><div class="details-form" id="details-form-hidden"><div class="ShippingItemContainer"><span class="boxSubHeading"><strong>*</strong> שם עבור חשבונית מס:</span><div><input type="text" id="bname" value="' + bname + '"><span class="input-err-desc"></span></div></div><div class="ShippingItemContainer"><span class="boxSubHeading"><strong>*</strong> מספר ח.פ:</span><div><input type="text" id="bid" value="' + bid + '"><span class="input-err-desc"></span></div></div></div></div><div id="update-btn-client"><span id="update-msg"></span><a href="#">שמירת פרטי לקוח</a></div></div>');

        }

        if ($('#ctl00_cphMainContent_BillingAddress_lblHeading').html() == "הכתובת הנבחרת") {
          /*
                $('#fname').val($('#ctl00_cphMainContent_BillingAddress_lblPersonName').html()); 
             $('#phone').val($('#ctl00_cphMainContent_BillingAddress_lblCity').html());
            $('#lname').val($('#ctl00_cphMainContent_BillingAddress_lblAddress1').html());
            $('#bname').val($('#ctl00_cphMainContent_BillingAddress_lblCompany').html());
           $('#bid').val($('#ctl00_cphMainContent_BillingAddress_lblAddress2').html());
          */
          document.getElementById("fname").defaultValue = $('#ctl00_cphMainContent_BillingAddress_lblPersonName').html();
          document.getElementById("phone").defaultValue = $('#ctl00_cphMainContent_BillingAddress_lblCity').html();
          document.getElementById("lname").defaultValue = $('#ctl00_cphMainContent_BillingAddress_lblAddress1').html();
          document.getElementById("bname").defaultValue = $('#ctl00_cphMainContent_BillingAddress_lblCompany').html();
          document.getElementById("bid").defaultValue = $('#ctl00_cphMainContent_BillingAddress_lblAddress2').html();
          $('#update-btn-client a').html("המשך לפרטי משלוח");
        }


        $('#details-wrapper .ShippingItemContainer').each(function () {
          $(this).on('keyup change paste focus', 'input', function () {
            $(this).attr('value', $(this).val());
            $(this).removeClass("input-error");
            $(this).parent().find(".input-err-desc").html("");
          });
        });
        $(".checkbox span").click(function () {
          $("#billingif").click();
        });
        var flag = "normal";
        $('#billingif').click(function () {
          $('#details-form-hidden').toggle();

          if ($('#billingif').is(':checked')) {

          }
          else {
            if ($('#bname').val() != '' || $('#bid').val() != '') {
              flag = "clear";
              $('#update-btn-client a').click();
              var iframe = $('#legacy-iframe', parent.document);
              iframe.removeClass("savedMsg");
              iframe.removeClass("updateMsg");
              iframe.addClass("noupdateMsg");
            }
          }

        });

        if ($('#bname').val() != '' || $('#bid').val() != '') {
          $('#billingif').click();
        }



        if ($('#ctl00_cphMainContent_BillingAddress_lnkAddAddress').length) {
          $('#ctl00_cphMainContent_trBillingAddress').hide();

          if ($('#ctl00_cphMainContentFooter_btnNext').is(':visible')) {
            $('#update-btn-client a').on("click", function () {
              if (validatePhone('phone') && $('#fname').val() != '' && $('#lname').val() != '' && (($('#billingif').is(':checked') && $('#bid').val() != '' && $('#bname').val() != '') || !($('#billingif').is(':checked')))) {

                setTimeout(function () {
                  $(".ui-widget-overlay").remove();
                  $('.BasicDialogContainer').addClass("billingPopup");
                }, 20);



                if ($('#ctl00_cphMainContent_BillingAddress_lnkAddAddress').html() == "הגדר כתובת חיוב") {
                  $('#ctl00_cphMainContent_BillingAddress_lnkAddAddress').click();
                  var iframe = $('#legacy-iframe', parent.document);
                  iframe.addClass("savedMsg");

                }
                else {
                  var iframe = $('#legacy-iframe', parent.document);
                  iframe.removeClass("savedMsg");
                  iframe.addClass("updateMsg");
                  $('#ctl00_cphMainContent_BillingAddress_lnkEditAddress').click();
                }
                setTimeout(function () {
                  if ($('#wndCustomerAddress').length >= 1) {
                    var iframe = document.getElementById('wndCustomerAddressFrame');
                    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
                    var finput = $('#fname').val();
                    var linput = $('#lname').val();
                    var pinput = $('#phone').val();
                    var cinput = $('#bname').val();
                    var binput = $('#bid').val();
                    if (flag != "clear") {
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtPersonName").attr("value", finput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtCompany").val(cinput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtAddress1").val(linput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtAddress2").val(binput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtCity").val(pinput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtZip").val("null");
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtPhone").val("null");
                    }
                    else {
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtPersonName").attr("value", finput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtCompany").val(" ");
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtAddress1").val(linput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtAddress2").val(" ");
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtCity").val(pinput);
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtZip").val("null");
                      $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtPhone").val("null");
                    }
                    setTimeout(function () {
                      $(innerDoc).find('#ctl00_cphFooterButtons_btnSubmit')[0].click();

                    }, 300);
                  }

                }, 600);

              }
              else {
                if ($('#phone').val() == '') {
                  $('#phone').addClass("input-error");
                  $('#phone').parent().find(".input-err-desc").html("מס' טלפון ריק");
                }
                else {
                  $('#phone').parent().find(".input-err-desc").html("");
                }
                if (!validatePhone('phone')) {
                  $('#phone').addClass("input-error");
                  $('#phone').parent().find(".input-err-desc").html("מס' טלפון לא תקין");
                }
                else {
                  $('#phone').parent().find(".input-err-desc").html("");
                }
                if ($('#fname').val() == '') {
                  $('#fname').addClass("input-error");
                  $('#fname').parent().find(".input-err-desc").html("שם פרטי ריק");
                }
                else {
                  $('#fname').parent().find(".input-err-desc").html("");
                }
                if ($('#lname').val() == '') {
                  $('#lname').addClass("input-error");
                  $('#lname').parent().find(".input-err-desc").html("שם משפחה ריק");
                }
                else {
                  $('#lname').parent().find(".input-err-desc").html("");
                }
                if (($('#billingif').is(':checked') && $('#bid').val() == '')) {
                  $('#bid').addClass("input-error");
                  $('#bid').parent().find(".input-err-desc").html("מספר ח.פ ריק");
                }
                else {
                  $('#bid').parent().find(".input-err-desc").html("");
                }
                if (($('#billingif').is(':checked') && $('#bname').val() == '')) {
                  $('#bname').addClass("input-error");
                  $('#bname').parent().find(".input-err-desc").html("שם עבור חשבונית ריק");
                }
                else {
                  $('#bname').parent().find(".input-err-desc").html("");
                }
                $('#update-msg').html('');
              }
            });

          }



          setTimeout(function () {
            $('.BasicDialogContainer').removeClass("billingPopup");
          }, 4000);

        }




      }

      //Function doable inside iframe
      function onLoadIframe() {
        setTimeout(function () {
          var iframe = document.getElementById('wndCustomerAddressFrame');
          var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
          var city = $(innerDoc).find(".Address_City");
          var street = $(innerDoc).find(".Address_Address1");
          var comp = $(innerDoc).find('.Address_Company');
          var zip = $(innerDoc).find('.Address_Address2');
          //Legacy fix design//
          $(innerDoc).find("#ctl00_cphFooterButtons_btnSubmit").html("שמירת הכתובת");
          $(innerDoc).find(".FormLabel").remove();
          $(innerDoc).find(".Address_Fax, .Address_DisplayName, .Address_Notice").remove();
          $(innerDoc).find(".ui-dialog-titlebar").addClass("hidden-titlebar");
          $('.BasicDialogContainer ').prepend('<div id="close-addr-form"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/close-dd.svg"></div>');
          $(innerDoc).find("#tblAddressEdit").prepend('<div id="ship-addr-title">הגדרות כתובת למשלוח<span></span></div>');
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtPersonName").attr("placeholder", "שם מלא");
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtCompany").attr("placeholder", "שם החברה (אופציונלי)");
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtCity").attr("placeholder", "עיר");
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtAddress1").attr("placeholder", "רחוב");
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtAddress2").attr("placeholder", "מספר בית");
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtZip").attr("placeholder", "מיקוד");
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtAddressReference").attr("placeholder", "הערות לשליח (אופציונאלי)");
          $(innerDoc).find("#ctl00_cphMainContent_ucAddress_txtPhone").attr("placeholder", "טלפון מקבל המשלוח");

          $(document).on("click", "#close-addr-form", function () {
            $(this).closest("#close-addr-form").remove();
            setTimeout(function () {
              $('.ui-dialog-titlebar-close').click();
            }, 500);
          });
          //Legacy fix end//
          function httpGet(theUrl) {
            var xmlHttp = new XMLHttpRequest();
            // Firefox 3.5 and Safari 4
            xmlHttp.open('GET', theUrl, false);
            xmlHttp.send();
            return xmlHttp;
          }





          $(innerDoc).find('.Address_Address1').insertBefore(city);
          //	$('<div class="listhandle" id="streetlist"><ul></ul></div>').insertAfter(street);	
          $(innerDoc).find('.Address_City').insertBefore(street);
          //$('<div class="listhandle" id="citylist"><ul></ul></div>').insertAfter(city);	
          $(innerDoc).find('.Address_Address2').insertAfter(street);
          street.append('<div class="listhandle" id="streetlist"><ul></ul></div>');
          city.append('<div class="listhandle" id="citylist"><ul></ul></div>');

          $(innerDoc).find('.Address_Phone').insertAfter(comp);
          $(innerDoc).find('.Address_Zip').insertAfter(zip);

          console.log("replace");
          if ($('#wndCustomerAddress').length >= 1) {

            var city = $(innerDoc).find(".Address_City");
            var street = $(innerDoc).find(".Address_Address1");
            street.find("input").attr("autocomplete", "none");

            city.find("input").attr("autocomplete", "none");
            var getLi = city.find("#citylist ul");
            var getLiSt = street.find("#streetlist ul");

            city.on('keyup change paste focus', 'input', function () {
              $(this).attr('value', $(this).val());
              $(this).removeClass("input-error");
              var inputVal = $(this).attr('value');
              if ($(this).attr('value').length >= 3) {
                var theUrl = "https://iprinthub.iprintd.com:30443/lookup/getAddress/city?city=" + $(this).attr('value');
                var x = httpGet(theUrl);
                var obj = JSON.parse(x.response);

                for (var i = 0; i < obj.length; i++) {
                  if (getLi.text().indexOf(obj[i].cityName) !== -1) {

                  }
                  else {
                    $(innerDoc).find("#citylist ul").append("<li>" + obj[i].cityName + "</li>");
                  }
                }
                getLi.find("li").each(function () {
                  if ($(this).text().indexOf(inputVal) > -1) {
                  }
                  else {
                    $(this).remove();
                  }

                  $(this).mousedown(function () {
                    city.find("input").val($(this).text());
                  });

                });
                if (getLi.is(':empty')) {
                  city.find("input").val("");
                  onBlur();
                }
                else {
                  $(innerDoc).find('#citylist').addClass("list-active").fadeIn();
                }


              }
              else {
                $(innerDoc).find("#citylist ul").html("");
              }

            });
            function onBlur() {
              $(innerDoc).find('#citylist').removeClass("list-active").fadeOut();
              $(innerDoc).find("#citylist ul").html("");
            }

            city.find("input").blur(function () {
              var currentVal = city.find("input").val();
              var exist = 0;
              getLi.find("li").each(function () {
                if ($(this).text() === currentVal) {
                  ++exist;
                }
                if (exist == 0) {
                  city.find("input").val("");
                  exist = 0;
                }
                console.log(exist);
              });
              onBlur();
              if (city.find("input").val().length < 3) {
                city.find("input").val("");
                street.find("input").val("");
              }
            });

            // End of city section

            street.on('keyup change paste focus', 'input', function () {
              $(this).attr('value', $(this).val());
              $(this).removeClass("input-error");
              var inputVal = $(this).attr('value');
              if ($(this).attr('value').length >= 3) {
                if (city.find("input").val().length >= 3) {
                  var theUrl = "https://iprinthub.iprintd.com:30443/lookup/getAddress/street?city=" + city.find("input").val() + "&street=" + $(this).attr('value');
                  var x = httpGet(theUrl);
                  var obj = JSON.parse(x.response);
                  console.log("this is the obj+" + obj);
                  for (var i = 0; i < obj.length; i++) {
                    if (getLiSt.text().indexOf(obj[i].streetName) !== -1) {

                    }
                    else {
                      $(innerDoc).find("#streetlist ul").append("<li>" + obj[i].streetName + "</li>");
                    }
                  }
                  getLiSt.find("li").each(function () {
                    if ($(this).text().indexOf(inputVal) > -1) {
                    }
                    else {
                      $(this).remove();
                      console.log("removeed:");
                      console.log($(this).text());
                    }

                    $(this).mousedown(function () {
                      street.find("input").val($(this).text());
                    });

                  });
                  if (getLiSt.is(':empty')) {
                    street.find("input").val("");
                    onBlurSt();
                  }
                  else {
                    $(innerDoc).find('#streetlist').addClass("list-active").fadeIn();
                  }

                  console.log("not empty city!");
                }
                else {
                  street.find("input").val("");
                  console.log(city.find("input").val());
                  console.log("its empty dont edit input.");
                }
              }

            });
            function onBlurSt() {
              $(innerDoc).find('#streetlist').removeClass("list-active").fadeOut();
              $(innerDoc).find("#streetlist ul").html("");
            }
            street.find("input").blur(function () {
              var currentVal = street.find("input").val();
              var exist = 0;
              getLiSt.find("li").each(function () {
                if ($(this).text() === currentVal) {
                  ++exist;
                }
                if (exist == 0) {
                  street.find("input").val("");
                  exist = 0;
                }
                console.log(exist);
              });

              onBlurSt();
              if (street.find("input").val().length < 3) {
                street.find("input").val("");
              }
            });


          }

        }, 120);
      }
      // End function doable inside iframe

      // Delivery fix
      $('iframe#wndCustomerAddressFrame').load(function () {
        onLoadIframe();
      });
      /*
      $('#ctl00_cphMainContent_ShippingAddress_lnkAddAddress, #ctl00_cphMainContent_ShippingAddress_lnkEditAddress').on("click", function () {
        onLoadIframe();
      });
      */


      // Fix selected input
      setTimeout(function () {
        $("#ctl00_cphMainContent_ShippingAddress_ddlAddresses option").each(function () {
          var txt = $(this).text();
          var result = txt.replace(',', ' ');
          $(this).html(result);
          $(this).attr("title", result);
        });
        // Fix current val
        var finalSelect = $("#ctl00_cphMainContent_ShippingAddress_lblAddress1").text() + ", " + $("#ctl00_cphMainContent_ShippingAddress_lblCity").text() + ", " + $("#ctl00_cphMainContent_ShippingAddress_lblZip").text() + ", " + $("#ctl00_cphMainContent_ShippingAddress_lblCountry").text();
        $('#ctl00_cphMainContent_ShippingAddress_ddlAddresses option:selected').html(finalSelect);
        $('#ctl00_cphMainContent_ShippingAddress_ddlAddresses option:selected').attr("title", finalSelect);

      }, 400);

      if ($("#radShippingAddressList_10008:checked").val() == "radShippingAddressList_10008") {
        $('#ctl00_cphMainContent_divShippingItems .ShippingItemContainer').eq(1).hide();
        $('#ctl00_cphMainContent_ShippingAddress_lblHeading').html("כתובת איסוף");
      }

      var iframe = $('#legacy-iframe', parent.document);

      if (iframe.hasClass("savedMsg")) {
        //$('#update-msg').html("פרטי הלקוח נשמרו בהצלחה");
        // User first time registered 
        $("#details-full").hide();
        $(".cellbottom").show();
        $(".ps-first").removeClass("active");
        $(".ps-first").addClass("step-done");
        $(".ps-second").addClass("active");
        $(".step-done .ps-container").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/step-c.svg">');
        $(".half-line-bg ").eq(0).addClass("half-line-done");
        $(".cellbottom").addClass("shipping-legacy");
        var iframe = document.getElementById('wndCustomerAddressFrame');
        var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
        $(innerDoc).find("#tblAddressEdit tr .FormField").remove();
        //$("#ctl00_cphMainContent_lblShippingHeader").parent().remove();
        $("#ctl00_cphMainContent_lblShippingAddress").hide();
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="pickup"><span class="ship-block-title">אפשרויות איסוף עצמי</span><div class="ship-block-box"><div class="box-option box-option-service"><div class="box-button box-button-selected"></div><div class="box-right">חברת אייפרינט (iPrint) - פתח תקווה<span>הסיבים 43, פתח תקווה<br>בניין C (קומת קרקע)</span></div><div class="box-left">חינם</div></div><div class="box-option box-option-service"><div class="box-button"></div><div class="box-right">חברת אייפרינט (iPrint) - באר שבע<span>יהודה הנחתום 6, באר שבע</span></div><div class="box-left">חינם</div></div></div></div>');
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="delivery"><span class="ship-block-title">שירות משלוחים</span><div class="ship-block-box"><div class="box-option box-option-service"><div class="box-button box-button-selected"></div><div class="box-right">שליח עד הבית<span>עד 48 שעות מהרגע בו ההזמנה מוכנה</span></div><div class="box-left">₪ 49</div></div><div class="box-option box-option-service"><div class="box-button"></div><div class="box-right">דואר שליחים<span>עד 7 ימי עסקים</span></div><div class="box-left">₪ 19</div></div></div></div>');
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="delivery-addr"><span class="ship-block-title">כתובת למשלוח</span><div class="ship-block-box"><div id="middle-ship"><span id="first-time-ship"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/delivery-truck.svg">פעם ראשונה כאן? איזה כיף!</span><span id="first-time-second">אנחנו רק צריכים לדעת לאן לשלוח את ההזמנה</span><a id="define-addr">הגדרת כתובת למשלוח</a></div></div></div>');
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="delivery-method"><span class="ship-block-title">שיטת משלוח</span><div class="ship-block-box"><div class="box-option" id="mdelivery"><div class="box-button box-button-selected"></div>משלוח</div><div class="box-option" id="mpickup"><div class="box-button"></div>איסוף עצמי</div></div></div>');

      }
      else if (iframe.hasClass("updateMsg")) {
        //$('#update-msg').html("פרטי הלקוח עודכנו בהצלחה");
        // User registered with details to continue scenario
        $("#details-full").hide();
        $(".cellbottom").show();
        $(".ps-first").removeClass("active");
        $(".ps-first").addClass("step-done");
        $(".ps-second").addClass("active");
        $(".step-done .ps-container").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/step-c.svg">');
        $(".half-line-bg ").eq(0).addClass("half-line-done");
        $(".cellbottom").addClass("shipping-legacy");
        var iframe = document.getElementById('wndCustomerAddressFrame');
        var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
        $(innerDoc).find("#tblAddressEdit tr .FormField").remove();
        //$("#ctl00_cphMainContent_lblShippingHeader").parent().remove();
        $("#ctl00_cphMainContent_lblShippingAddress").hide();
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="pickup"><span class="ship-block-title">אפשרויות איסוף עצמי</span><div class="ship-block-box"><div class="box-option box-option-service" id="pt"><div class="box-button box-button-selected"></div><div class="box-right">חברת אייפרינט (iPrint) - פתח תקווה<span>הסיבים 43, פתח תקווה<br>בניין C (קומת קרקע)</span></div><div class="box-left">חינם</div></div><div class="box-option box-option-service" id="bs"><div class="box-button"></div><div class="box-right">חברת אייפרינט (iPrint) - באר שבע<span>יהודה הנחתום 6, באר שבע</span></div><div class="box-left">חינם</div></div></div></div>');
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="delivery"><span class="ship-block-title">שירות משלוחים</span><div class="ship-block-box"><div class="box-option box-option-service"><div class="box-button box-button-selected"></div><div class="box-right">שליח עד הבית<span>עד 48 שעות מהרגע בו ההזמנה מוכנה</span></div><div class="box-left">₪ 49</div></div><div class="box-option box-option-service"><div class="box-button"></div><div class="box-right">דואר שליחים<span>עד 7 ימי עסקים</span></div><div class="box-left">₪ 19</div></div></div></div>');
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="delivery-addr"><span class="ship-block-title">כתובת למשלוח</span><div class="ship-block-box"><div id="middle-ship"><span id="first-time-ship"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/delivery-truck.svg">פעם ראשונה כאן? איזה כיף!</span><span id="first-time-second">אנחנו רק צריכים לדעת לאן לשלוח את ההזמנה</span><a id="define-addr">הגדרת כתובת למשלוח</a></div></div></div>');
        $("#ctl00_cphMainContent_trShipping").prepend('<div class="ship-block" id="delivery-method"><span class="ship-block-title">שיטת משלוח</span><div class="ship-block-box"><div class="box-option" id="mdelivery"><div class="box-button box-button-selected"></div>משלוח</div><div class="box-option" id="mpickup"><div class="box-button"></div>איסוף עצמי</div></div></div>');
        if ($("#ctl00_cphMainContent_ShippingAddress_lnkAddAddress").html() != "הגדרת כתובת משלוח") {
          $('<a id="add-addr">+ הוספת כתובת למשלוח</a>').insertAfter("#delivery-addr .ship-block-box");
          $("#delivery-addr .ship-block-box").html('');
          $("#ctl00_cphMainContent_ShippingAddress_ddlAddresses option").each(function () {
            if ($(this).is(':selected')) {
              $("#delivery-addr .ship-block-box").append('<div class="box-option"><div class="box-button box-button-selected"></div><div class="box-right"><span data-val="' + $(this).attr("value") + '">' + $(this).text() + '</span></div><div class="box-left edit-addr"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/edit-addr.svg">עריכה</div></div>');
            }
            else {
              $("#delivery-addr .ship-block-box").append('<div class="box-option"><div class="box-button"></div><div class="box-right"><span data-val="' + $(this).attr("value") + '">' + $(this).text() + '</span></div><div class="box-left"></div></div>');
            }
          });
        }
        $("#define-addr").on("click", function () {
          $("#ctl00_cphMainContent_ShippingAddress_lnkAddAddress").click();
        });
        $('.edit-addr').on("click", function () {
          $("#ctl00_cphMainContent_ShippingAddress_lnkEditAddress").click();
        });
        $("#add-addr").on("click", function () {
          $("#ctl00_cphMainContent_ShippingAddress_lnkAddAddress").click();
        });
        $('#delivery-addr .box-button').on("click", function () {
          if (!$(this).hasClass("box-button-selected")) {
            var toSelect = $(this).parent().find(".box-right span").attr("data-val");
            console.log(toSelect);
            $("#ctl00_cphMainContent_ShippingAddress_ddlAddresses").val(toSelect);
            setTimeout('__doPostBack(\'ctl00$cphMainContent$ShippingAddress$ddlAddresses\',\'\')', 0);
          }
        });

        $("#delivery .ship-block-box").html('');

        $("#ctl00_cphMainContent_cmbServices option").each(function () {
          if ($(this).is(':selected')) {
            var withNoDigits = $(this).text().replace(/[0-9]/g, '');
            var fixedVal = $.trim(withNoDigits).replace(/ILS|₪/g, "").replace(/\./g, '');
            var price = "₪" + $(this).text().replace(/[^0-9.-]/g, '').replace(/(\..*)\./g, '$1').replace(/(?!^)-/g, '').replace(/^0+(\d)/gm, '$1');

            $("#delivery .ship-block-box").append('<div class="box-option box-option-service"><div class="box-button box-button-selected"></div><div class="box-right" data-val="' + $(this).attr("value") + '">' + fixedVal + '<span></span></div><div class="box-left">' + price + '</div></div>');
          }
          else {
            var withNoDigits = $(this).text().replace(/[0-9]/g, '');
            var fixedVal = $.trim(withNoDigits).replace(/ILS|₪/g, "").replace(/\./g, '');
            var price = "₪" + $(this).text().replace(/[^0-9.-]/g, '').replace(/(\..*)\./g, '$1').replace(/(?!^)-/g, '').replace(/^0+(\d)/gm, '$1');
            $("#delivery .ship-block-box").append('<div class="box-option box-option-service"><div class="box-button"></div><div class="box-right" data-val="' + $(this).attr("value") + '">' + fixedVal + '<span></span></div><div class="box-left">' + price + '</div></div>');
          }
        });

        $('#delivery .box-button').on("click", function () {
          if (!$(this).hasClass("box-button-selected")) {
            var toSelect = $(this).parent().find(".box-right").attr("data-val");
            console.log(toSelect);
            $("#ctl00_cphMainContent_cmbServices").val(toSelect);
            setTimeout('__doPostBack(\'ctl00$cphMainContent$ShippingAddress$ddlAddresses\',\'\')', 0);
          }
        });

        $("#mdelivery").on("click", function () {
          if (!$(this).find(".box-button").hasClass("box-button-selected")) {
            $("#delivery-addr, #delivery").show();
            $("#pickup").hide();
            $("#radShippingAddressList_10008").removeAttr("checked");
            $("#radSelectAddress").prop("checked", true);
            $(this).find(".box-button").addClass("box-button-selected");
            $(this).parent().find("#mpickup .box-button").removeClass("box-button-selected");
          }
        });
        $("#mpickup").on("click", function () {
          if (!$(this).find(".box-button").hasClass("box-button-selected")) {
            $("#delivery-addr, #delivery").hide();
            $("#pickup").show();
            $("#bs .box-button").removeClass("box-button-selected");
            $("#pt .box-button").addClass("box-button-selected");
            $("#radSelectAddress").removeAttr("checked");
            $("#radShippingAddressList_10008").prop("checked", true);
            $(this).find(".box-button").addClass("box-button-selected");
            $(this).parent().find("#mdelivery .box-button").removeClass("box-button-selected");
          }
        });

        $("#pt").on("click", function () {
          if (!$(this).find(".box-button").hasClass("box-button-selected")) {
            $("#radShippingAddressList_10010").removeAttr("checked");
            $("#radShippingAddressList_10008").prop("checked", true);
            $(this).find(".box-button").addClass("box-button-selected");
            $(this).parent().find("#bs .box-button").removeClass("box-button-selected");
          }
        });
        $("#bs").on("click", function () {
          if (!$(this).find(".box-button").hasClass("box-button-selected")) {
            $("#radShippingAddressList_10008").removeAttr("checked");
            $("#radShippingAddressList_10010").prop("checked", true);
            $(this).find(".box-button").addClass("box-button-selected");
            $(this).parent().find("#pt .box-button").removeClass("box-button-selected");
          }
        });
        $("#ctl00_cphMainContent_lblShippingAddress").parent().hide();
        $(".mainAreaFooterFullWidth").hide();
        $('<a id="continue-pay-btn" href="#">המשך לתשלום</a>').insertAfter("#ctl00_cphMainContent_trShipping");
        $(document).on("click", "#continue-pay-btn", function () {
          WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions("ctl00$cphMainContentFooter$btnNext", "", true, "", "", false, true));
          console.log("clicked");
        });
      }
      else {
        $('#update-msg').html("");
      }



      if (!$('.checkoutSubmissionOrderPriceContainerContainer').length) {
        if ($("#fullpage").text().includes('₪') && !$('.ShippingItemContainer').length) {
          $("#fullpage").contents().each(function () {
            if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "")
            if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""))
          })
        }


        if ($(".container").text().includes('₪') && !$('.ShippingItemContainer').length) {
          $(".container").contents().each(function () {
            if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "")
            if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""))
          })
        }
      }


      $("#ctl00_cphMainContent_cmbServices").find("option").each(function (index, option) {
        $(option).html($(option).html().replace(/ILS/g, ''));
      });



      if ($('.details-error').length) {
        $('#validationSummary').addClass("hideError");
      }
      $('.checkoutFinalNext a').on("click", function () {
        setTimeout(function () {
          if ($('#validationSummary').is(':visible')) {
            $('.details-error').html('');
            var i;
            var errors = $('#validationSummary ul li').length;
            for (i = 0; i < errors; i++) {
              $('.details-error').append($('#validationSummary ul li').eq(i).html() + "<br>");
            }
          }
        }, 200);
        var iframe = $('#legacy-iframe', parent.document);
        iframe.addClass("scrollTop");
        if (iframe.hasClass("scrollTop")) {
          if ($(window).width() > 1216) {
            $('html, body', window.parent.document).animate({ scrollTop: 0 }, 'slow');
            iframe.addClass("goTop");
          }
        }
        else {
          iframe.removeClass("goTop");

        }
      });



      if ($(window).width() < 1199) {
        $('.uStoreLegacy-padding5_37_5_0').parents(".toggled").find("td").eq(0).remove();
      }


      if ($('.shippingServicesWrapper').length || $('#ctl00_cphMainContent_lblPaymentType').length) {
        setTimeout(function () {
          $('.alert').addClass("shipping-danger");
        }, 500);
      }

      if ($(window).width() < 1216) {
        $('#validationSummary').removeClass("hideError");
        $('.details-error').addClass("mobileHide");
        if ($("#ctl00_cphMainContent_ShippingAddress_lnkAddAddress").html() == "הגדר כתובת משלוח") {
          $('.AddressBox_Checkbox').parents("span.uStoreLegacy-width100percent").eq(0).addClass("no-fix-width-box");
          $('#ctl00_cphMainContent_ShippingAddress_lnkAddAddress').addClass("no-padding-box");
        }

        if ($('#ctl00_cphMainContent_lblShippingHeader').html() == "פריטים בהזמנה") {
          $('#ctl00_cphMainContent_lblShippingHeader').parents(".ShippingItemContainer").eq(0).remove();
        }
      }

      if ($('#validationSummary ul li').html() == "Clearing Cancelled") {
        $('#validationSummary ul li').html("העסקה בוטלה");
      }
      else if ($('#validationSummary ul li').html() == "Clearing Failed") {
        $('#validationSummary ul li').html("העסקה נכשלה. יש לבדוק היטב את פרטי כרטיס האשראי שהוזנו");
      }




      if ($('.ShippingAddressWrapper').length || $('.checkoutFinalCheckout').length) {
        $('.mainAreaFooterFullWidth').addClass("footerFixed");
      }

      if ($('.subTitleProductNameExists').length) {
        $('#searcharea #ctl00_containerPageProductName').html("הזמנת פוסטרים");
      }
      else {
        $('.subtitleProductName').remove();
      }


      $('.ShoppingCartGrid_Column_Buttons').each(function () {
        $(this).parent().find('a[title="לרכישה מאוחר יותר"]').remove();
      });


    }
    // End Added JS From OLD //
    //Checkout Summary page
    if (refLegacy.includes("CheckoutPaymentSubmission")) {
      $("#searcharea, .breadCrumbs").remove();
      $("#fullpage").prepend('<div id="purchase-timeline"><div id="line-bg"><div class="half-line-bg"></div><div class="half-line-bg"></div></div><div class="pstep ps-first active"><div class="ps-container"><div class="ps-circle"></div></div><span>פרטי לקוח</span></div><div class="pstep ps-second"><div class="ps-container"><div class="ps-circle"></div></div><span>פרטי משלוח</span></div><div class="pstep ps-third"><div class="ps-container"><div class="ps-circle"></div></div><span>סיכום הזמנה</span></div></div>');
      $(".ps-first").removeClass("active");
      $(".ps-first").addClass("step-done");
      $(".ps-second").removeClass("active");
      $(".ps-second").addClass("step-done");
      $(".ps-third").addClass("active");
      $(".step-done .ps-container").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/step-c.svg">');
      $(".half-line-bg ").eq(0).addClass("half-line-done");
      $(".half-line-bg ").eq(1).addClass("half-line-done");
      $(".cellbottom").addClass("pay-page");
      $("#ctl00_cphMainContent_ucShoppingCart_LblTitle ").html("סיכום הזמנה");
      $('.ShoppingCartGrid_Column_NotificationIcon').remove();
      $(".rgMasterTable thead").remove();
      $('.btn-group').parent().parent().remove();
      $(".rgMasterTable tbody tr").each(function () {
        //$(this).find("td").eq(3).remove();
        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/סה"כ:/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/סה"כ:/g, ""));

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/פריטים/g, "יחידות");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/פריטים/g, "יחידות"));

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/פריט/g, "יחידה");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/פריט/g, "יחידה"));




        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""));

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/₪/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/₪/g, ""));
        $(this).find(".BoldPriceLabel").append("₪");
      });
      $('.pay-page .OrderPriceTable tr').each(function () {
        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""));

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/₪/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/₪/g, ""));
        $(this).find(".tdAmount").append("₪");
      });

      $("#ctl00_cphMainContent_ucOrderPrice_lblShippingLabel").html("דמי משלוח");
      $("#ctl00_cphMainContent_ucOrderPrice_lblSubtotalLabel").html('סה"כ לפני מע"מ');
      $("#ctl00_cphMainContent_ucOrderPrice_lblTotalLabel").html('סה"כ כולל מע"מ');
      $("#ctl00_cphMainContent_ucOrderPrice_trTax").insertBefore("#ctl00_cphMainContent_ucOrderPrice_trShipping");
      $("#ctl00_cphMainContent_ucOrderPrice_lnkTaxDetails").html('מע"מ');
      $('.pay-page .OrderPriceContainer').parent().addClass("parentChk");
      $('.pay-page #ctl00_cphMainContent_trPaymentMethods').hide();
      $('#ctl00_cphMainContent_HideShippingType').prepend('<div class="ship-block" id="pay-methods"><span class="ship-block-title">שיטת תשלום</span><div class="ship-block-box"><div class="box-option" id="cc-method"><div class="box-button box-button-selected"></div>כרטיס אשראי</div><div class="box-option" id="pp-method"><div class="box-button"></div>פייפאל</div><div class="box-option" id="invoice-method"><div class="box-button"></div>חשבונית בסוף החודש</div></div><a id="continue-pay-btn" href="#">המשך לתשלום</a></div>');
      $("#cc-method").on("click", function () {
        if (!$(this).find(".box-button").hasClass("box-button-selected")) {
          $("#ctl00_cphMainContent_rdlClearingConfig_1, #ctl00_cphMainContent_rdlClearingConfig_2").removeAttr("checked");
          $("#ctl00_cphMainContent_rdlClearingConfig_0").prop("checked", true);
          $(this).find(".box-button").addClass("box-button-selected");
          $(this).parent().find("#pp-method .box-button").removeClass("box-button-selected");
          $(this).parent().find("#invoice-method .box-button").removeClass("box-button-selected");
        }
      });
      $("#pp-method").on("click", function () {
        if (!$(this).find(".box-button").hasClass("box-button-selected")) {
          $("#ctl00_cphMainContent_rdlClearingConfig_0, #ctl00_cphMainContent_rdlClearingConfig_1").removeAttr("checked");
          $("#ctl00_cphMainContent_rdlClearingConfig_2").prop("checked", true);
          $(this).find(".box-button").addClass("box-button-selected");
          $(this).parent().find("#cc-method .box-button").removeClass("box-button-selected");
          $(this).parent().find("#invoice-method .box-button").removeClass("box-button-selected");
        }
      });
      $("#invoice-method").on("click", function () {
        if (!$(this).find(".box-button").hasClass("box-button-selected")) {
          $("#ctl00_cphMainContent_rdlClearingConfig_0, #ctl00_cphMainContent_rdlClearingConfig_2").removeAttr("checked");
          $("#ctl00_cphMainContent_rdlClearingConfig_1").prop("checked", true);
          $(this).find(".box-button").addClass("box-button-selected");
          $(this).parent().find("#pp-method .box-button").removeClass("box-button-selected");
          $(this).parent().find("#cc-method .box-button").removeClass("box-button-selected");
        }
      });
      $("#ctl00_cphMainContent_trPaymentMethodDivider").hide();
      $(".CheckoutTdRounding").hide();
      $(".mainAreaFooterFullWidth").hide();
      $(document).on("click", "#continue-pay-btn", function () {
        __doPostBack('ctl00$cphMainContentFooter$btnCheckout', '');
      });
    }
    //Order captured page
    if (refLegacy.includes("CheckOutComplete")) {
      $('#searcharea').remove();
      $('#fullpage').addClass("chk-comp");
      $("#fullpage").prepend('<div id="purchase-timeline"><div id="line-bg"><div class="half-line-bg"></div><div class="half-line-bg"></div></div><div class="pstep ps-first active"><div class="ps-container"><div class="ps-circle"></div></div><span>פרטי לקוח</span></div><div class="pstep ps-second"><div class="ps-container"><div class="ps-circle"></div></div><span>פרטי משלוח</span></div><div class="pstep ps-third"><div class="ps-container"><div class="ps-circle"></div></div><span>סיכום הזמנה</span></div></div>');
      $(".ps-first").removeClass("active");
      $(".ps-first").addClass("step-done");
      $(".ps-second").removeClass("active");
      $(".ps-second").addClass("step-done");
      $(".ps-third").addClass("active");
      $(".ps-third").removeClass("active");
      $(".ps-third").addClass("step-done");
      $(".step-done .ps-container").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/step-c.svg">');
      $(".half-line-bg ").eq(0).addClass("half-line-done");
      $(".half-line-bg ").eq(1).addClass("half-line-done");
      $('.mainareaFullWidth').prepend('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/check-mark.svg" id="chkd">');
      $("#tdCheckoutCompleteSuccessfuly").html("הזמנתך <span>#" + $("#ctl00_cphMainContent_OrderNumber").text() + "</span> נקלטה בהצלחה!");
      $("#ctl00_cphMainContent_LblMessage").html("נדאג ליידע אותך ברגע שההזמנה שלך תהיה מוכנה");
      $("#tdCheckoutCompleteOrderNumber").remove();
      $(".chk-comp .mainAreaFooterFullWidth").append('<div id="last-to-know"><span id="main-last">דברים קטנים אחרונים…</span><p>עם סיום הדפסת ההזמנה ואריזתה, יישלחו ללקוח אימייל או/ו SMS המודיעים לו על כך.</p><span class="sec-last">הזמנות באיסוף עצמי</span><p>את ההזמנה ניתן לאסוף בימים א עד ה בין השעות 09:00 ל-18:00 מנקודת האיסוף שהוגדרה על ידי הלקוח.סניף פתח תקווה - הסיבים 43, פתח תקווה - בניין C, קומת קרקע סניף באר שבע - יהודה הנחתום 6, באר שבע</p><span class="sec-last">הזמנות במשלוח</span><p>משלוח תוך 48 שעות מהרגע שההזמנה מוכנה לכל רחבי הארץ למעט אילת ואזורים מרוחקים. מס מעקב למשלוח יישלח ללקוח עם אריזת ההזמנה.</p><p id="last-row">לכל שאלה או תקלה הקשורה בהזמנתך, <a href="/contact">צור איתנו קשר.</a></p></div>');
    }

    // Order page
    if (refLegacy.includes("OrderDetails")) {
      $("#fullpage").addClass("order-legacy-page");
      var orderId = $("#ctl00_cphMainContent_lblOrderNumber").text();
      $(".order-legacy-page #searcharea").prepend('<div class="ol-title">הזמנה #' + orderId);
      $(".order-legacy-page #searcharea").prepend('<div class="ol-approve">הצג אישור הזמנה<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/order-open.svg"></div>');
      $(".order-legacy-page #tableShipmentsContainer, .order-legacy-page #ctl00_containerPageProductName").remove();
      $(".order-legacy-page #ctl00_containerPageSubTitle, .order-legacy-page #ctl00_cphMainContent_lblTitleDelivery").remove();
      $("#ctl00_cphMainContent_lbltxtPaymentMethod, #ctl00_cphMainContent_lblOrderNumber").parent().hide();
      $("#ctl00_cphMainContent_lblTitlePurchase").remove();
      $(document).on("click", ".ol-approve", function () {
        $("#ctl00_cphMainContent_lnkShowReceipt").click();
      });
      $(".rgMasterTable thead").remove();
      $(".rgMasterTable tbody tr").each(function () {
        if (this.innerText === '') {
          this.remove();
        }
        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/סה"כ:/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/סה"כ:/g, ""));

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/פריטים/g, "יחידות");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/פריטים/g, "יחידות"));

        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/פריט/g, "יחידה");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/פריט/g, "יחידה"));


        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""));


        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/₪/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/₪/g, ""));

        var toBeMoved = $(this).find("td").eq(1);
        $(toBeMoved).insertAfter($(this).find(".OrderDetailsGrid_Column_Units"));

        var toBeMoved = $(this).find("td").eq(1);
        $(toBeMoved).prepend("<div class='prod-name'>" + $(this).find(".OrderDetailsProductNameDiv").text() + "</div>");

        var toBeMoved = $(this).find("td").eq(2);
        $(toBeMoved).insertAfter($(this).find(".OrderDetailsGrid_Column_Price"));

        $(this).find("td").eq(3).find(".OrderDetailsProductNameDiv").remove();
        $(this).find("td").eq(3).find(".Link").html('<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/reorder-icon.svg">הזמן מחדש');

        $(this).find("td").eq(2).find(".OrderDetailsBoldPriceLabel").append("₪");
        $(this).find("td").eq(2).find(".OrderDetailsBoldPriceLabel").append('<span class="include-tax">כולל מע"מ</span>');
      });

      $(".order-legacy-page .MoreInfoLabel").parent().remove();

      $(".order-legacy-page .OrderDetailsPriceSummary tr").each(function () {
        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/ILS/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/ILS/g, ""));


        if (this.nodeType === 3) this.nodeValue = $.trim($(this).text()).replace(/₪/g, "");
        if (this.nodeType === 1) $(this).html($(this).html().replace(/₪/g, ""));
        $(this).find(".OrderDetailsBoldPriceLabel").append("₪");
      });
      $("#ctl00_cphMainContent_trTaxRow").find(".OrderDetailsPriceSummaryCaption").html('מע"מ:');
      $('.OrderDetailsPriceSummary tr').last().addClass("price-row");
      $(".backLinkContainer").hide();

    }

    // Business Card page 
    if (refLegacy.includes("OrderFinalStep")) {
      $(".ThemedPagedFullWidthMaster").addClass("order-product-legacy");
      $(".order-product-legacy .Tooltip").remove();
      $(".order-product-legacy #tdDocCtrlRight").remove();
      $('<td id="right-navi"></td>').insertBefore(".order-product-legacy #tdDocCtrlLeft");

      // General settings
      var ProductId = $(".product-id").html().trim();
      var GlobalApiDomain = "https://iprinthub.iprintd.com:30443/portal/dbquery?queryName=";

      // GET Method implementation
      function httpGet(theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open('GET', theUrl, false);
        xmlHttp.send();
        return xmlHttp;
      }


      // Asset size widget:
      if ($(".AssetSize").length) {
        // Asset size general info api
        var AssetSizeValuesUrl = GlobalApiDomain + "PropertyDes&queryVal=" + ProductId + "&queryVal2=AssetSize";
        var x = httpGet(AssetSizeValuesUrl);
        var obj = JSON.parse(x.response);
        var recomAssetSize;

        $(".AssetSize").find(".property-title span").html(obj[0].TITLE);
        if (obj[0].GENERALPORTALDES1 !== "") {
          console.log("not empty desc by api");
          var infoBlock = '<div class="info-product"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/more-info-product.svg"><div class="info-proudct-box"></div></div>';
          $(infoBlock).insertAfter(".AssetSize .property-title span");
          $(".AssetSize").find(".info-proudct-box").html(obj[0].GENERALPORTALDES1 + obj[0].GENERALPORTALDES2);
          $(".AssetSize .info-product").hover(function () {
            $(this).find(".info-proudct-box").show();
          }, function () {
            $(this).find(".info-proudct-box").hide();
          });
        }

        // Asset sizes block api
        var AssetSizeValuesUrl = GlobalApiDomain + "AssetSize&queryVal=" + ProductId;
        var x = httpGet(AssetSizeValuesUrl);
        var obj = JSON.parse(x.response);
        if (obj[0].SIZEC !== "") {
          for (var i = obj.length - 1; i >= 0; i--) {
            if (obj[i].DEF === "Y") {
              recomAssetSize = obj[i].SIZEC.toLowerCase();
            }
            var assetBlock = '<div class="size-block" data-size-val="' + obj[i].SIZEC.toLowerCase() + '"><span>' + obj[i].SIZEC.toLowerCase() + '</span><img src="' + obj[i].ASSET + '"></div>';
            $(".AssetSize .property-value").prepend(assetBlock);
          }
        }
        console.log(obj.length);
        console.log("this is recommended object " + recomAssetSize);
        if (recomAssetSize != "") {
          $(".size-block[data-size-val|='" + recomAssetSize + "']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
        }
        // Asset sizes inputs dimensions block api
        var minAssetWidth;
        var maxAssetWidth;
        var minAssetHeight;
        var maxAssetHeight;

        var GetLimitAssetSizeUrl = GlobalApiDomain + "GetLimitAssetSize&queryVal=" + ProductId;
        var x = httpGet(GetLimitAssetSizeUrl);
        var obj = JSON.parse(x.response);
        if (obj[0].ESHK_PMINW !== "") {
          minAssetWidth = obj[0].ESHK_PMINW
          maxAssetWidth = obj[0].ESHK_PMAXW;
          minAssetHeight = obj[0].ESHK_PMINH;
          maxAssetHeight = obj[0].ESHK_PMAXH;
        }


        // Asset size implement pass value:
        $(".AssetSize .size-block").on("click", function () {
          $(".AssetSize .size-block, #custom-size-widget").removeClass("selected-size-block");
          $("#custom-height, #custom-width").val("");
          $("#custom-height, #custom-width").parent().removeClass("size-error");
          $("#custom-height, #custom-width").parent().removeClass("selected-inputs");
          $(".size-error-txt").hide();

          $(this).addClass("selected-size-block");
          passAssetSize($(this).attr("data-size-val"));
          console.log($(this).attr("data-size-val"));
        });
        var customSize;
        $("#custom-height, #custom-width").on('keyup change paste focus', function () {
          $(this).parent().removeClass("size-error");
          $(this).parent().find(".size-error-txt").fadeOut();
          $(this).attr('value', $(this).val());
          customSize = $("#custom-height").val() + "x" + $("#custom-width").val();
          passAssetSize(customSize);
          console.log(customSize);
        });

        $("#custom-size-widget").on("click", function () {
          $(".AssetSize .size-block").removeClass("selected-size-block");
          $(this).addClass("selected-size-block");
          $("#custom-height, #custom-width").parent().addClass("selected-inputs");
          passAssetSize(customSize);
          console.log(customSize);
        });
        $("#custom-height").blur(function () {
          console.log("blurred!!");
          if (maxAssetHeight != "" && minAssetHeight != "") {
            if (($(this).val() > maxAssetHeight || $(this).val() < minAssetHeight) && $(this).val() != "") {
              $(this).parent().addClass("size-error");
              $(this).parent().find(".size-error-txt").fadeIn();
            }
          }
        });
        $("#custom-width").blur(function () {
          console.log("blurred!!");
          if (minAssetHeight != "" && minAssetHeight != "") {
            if (($(this).val() > maxAssetWidth || $(this).val() < minAssetWidth) && $(this).val() != "") {
              $(this).parent().addClass("size-error");
              $(this).parent().find(".size-error-txt").fadeIn();
            }
          }
        });

      }


      // Orientation widget:
      if ($(".Orientation").length) {
        var OrientationUrl = GlobalApiDomain + "OrientationRecommended&queryVal=" + ProductId;
        var x = httpGet(OrientationUrl);
        var obj = JSON.parse(x.response);
        var recomOrientation;
        if (obj[0].ESHK_ORIENTATION != "") {
          recomOrientation = obj[0].ESHK_ORIENTATION;
        }
        console.log("this is recom obj: " + recomOrientation);
        if (recomOrientation != "") {
          $(".Orientation .half-block[data-orientation|='" + recomOrientation + "']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
        }
        $(".Orientation .half-block").on("click", function () {
          $(".Orientation .half-block").removeClass("selected-size-block");
          $(this).addClass("selected-size-block");
          passOrientation($(this).attr("data-orientation"));
          console.log($(this).attr("data-orientation"));
        });
      }

      // SidesAsset widget:
      if ($(".SidesAsset").length) {
        var SidesAssetUrl = GlobalApiDomain + "SidesAssetRecommended&queryVal=" + ProductId;
        var x = httpGet(SidesAssetUrl);
        var obj = JSON.parse(x.response);
        var recomSidesAsset;
        if (obj[0].ESHK_RECSIDE != "") {
          recomSidesAsset = obj[0].ESHK_RECSIDE;
        }
        console.log("this is recom obj: " + recomSidesAsset);
        if (recomSidesAsset != "") {
          $(".SidesAsset .half-block[data-sidesasset|='" + recomSidesAsset + "']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
        }
        $(".SidesAsset .half-block").on("click", function () {
          $(".SidesAsset .half-block").removeClass("selected-size-block");
          $(this).addClass("selected-size-block");
          passSidesAsset($(this).attr("data-sidesasset"));
          console.log($(this).attr("data-sidesasset"));
        });
      }


      // SubstrateType1 widget:
      if ($(".SubstrateType1").length) {
        var SubstrateType1ValuesUrl = GlobalApiDomain + "SubstrateType1Common&queryVal=" + ProductId;
        var x = httpGet(SubstrateType1ValuesUrl);
        var obj = JSON.parse(x.response);
        var substrateExclude = new Array(3);

        if (obj[0].SIZEC !== "") {
          for (var i = 0; i < obj.length; i++) {
            if (obj[i].DEF === "Y") {
              recomPaperTypeBlock = obj[i].SUBFAMILYDES.toLowerCase();
            }

            var SubstrateTypeAsset1ValuesUrl = GlobalApiDomain + "SubstrateType1";
            var z = httpGet(SubstrateTypeAsset1ValuesUrl);
            var aobj = JSON.parse(z.response);
            var substrateAsset;
            var substrateDesc;
            console.log("this is the aobj:" + substrateAsset);
            for (var j = 0; j < aobj.length; j++) {
              if (aobj[j].SUBFAMILYDES === obj[i].SUBFAMILYDES.toLowerCase()) {
                substrateAsset = aobj[j].ASSETLOC;
                substrateDesc = aobj[j].GENPORTDESC;
                substrateExclude[i] = aobj[j].SUBFAMILYDES;
              }
            }
            var paperTypeBlock = '<div class="size-block" data-substratetype1-val="' + obj[i].SUBFAMILYDES.toLowerCase() + '"><span>' + obj[i].SUBFAMILYDES.toLowerCase() + '</span><p>' + substrateDesc + '</p><img class="substrate-img" src="' + substrateAsset + '"></div>';
            //$(".SubstrateType1 .property-value").append(paperTypeBlock);
            $(paperTypeBlock).insertBefore("#more-types-sub");
          }
        }
        if (recomPaperTypeBlock != "") {
          $(".size-block[data-substratetype1-val|='" + recomPaperTypeBlock + "']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
        }
        console.log(substrateExclude);
        var SubstrateTypeAsset1ValuesAllUrl = GlobalApiDomain + "SubstrateType1";
        var z = httpGet(SubstrateTypeAsset1ValuesAllUrl);
        var aobj = JSON.parse(z.response);
        var sortElms = new Array();
        var counterSort = 0;
        for (var j = 0; j < aobj.length; j++) {
          for (var k = 0; k < aobj.length; k++) {
            //if(!substrateExclude.includes(aobj[k].SUBFAMILYDES)){		
            if (aobj[k].SORTPORTAL == counterSort) {
              //$("#list-sub ul").append('<li data-substratetype1-val="'+aobj[k].SUBFAMILYDES.toLowerCase()+'">'+aobj[k].SUBFAMILYDES.toLowerCase()+'</li>');							
              if (!substrateExclude.includes(aobj[k].SUBFAMILYDES)) {
                if (aobj[k].SUBFAMILYDES.trim() != "") {
                  $("#list-sub ul").append('<li data-substratetype1-val="' + aobj[k].SUBFAMILYDES.toLowerCase() + '" data-asset="' + aobj[k].ASSETLOC + '" data-shortdesc="' + aobj[k].GENPORTDESC + '">' + aobj[k].SUBFAMILYDES.toLowerCase() + '</li>');
                  if (counterSort == 4) {
                    //$("#list-sub ul li[data-substratetype1-val|='"+aobj[k].SUBFAMILYDES.toLowerCase()+"']").addClass("altSubstratItem");
                    $("#alt-substrat span").html(aobj[k].SUBFAMILYDES.toLowerCase());
                    $("#alt-substrat p").html(aobj[k].GENPORTDESC);
                    $("#alt-substrat img").attr("src", aobj[k].ASSETLOC);
                  }
                }
              }
              counterSort++;
              continue;
            }
            //}
          }
        }
        $(".SubstrateType1 .size-block").on("click", function () {
          if ($("#list-of-sub").hasClass("open-types")) {
            $("#more-types-sub img").removeClass("rotate-arr-types");
            $(document).find("#list-of-sub ul li").removeClass("altSubstratItem");
            $("#list-of-sub").removeClass("open-types");
          }
          $(document).find(".SubstrateType1 .size-block").removeClass("selected-size-block");
          $(this).addClass("selected-size-block");
          passSubstrateType1($(this).attr("data-substratetype1-val"));
          paperWeightComp($(this).attr("data-substratetype1-val"), recomPaperTypeBlock);
          console.log($(this).attr("data-substratetype1-val"));
        });
        $("#more-types-sub").on("click", function () {
          if ($("#list-of-sub").hasClass("open-types")) {
            $(this).find("img").removeClass("rotate-arr-types");
            $("#list-of-sub").removeClass("open-types");
          }
          else {
            $(this).find("img").addClass("rotate-arr-types");
            $("#list-of-sub").addClass("open-types");
            //$(document).find(".SubstrateType1 .size-block").removeClass("selected-size-block");
            //passSubstrateType1($(".altSubstratItem").attr("data-substratetype1-val"));
            //console.log($(".altSubstratItem").attr("data-substratetype1-val"));
          }
        });

        $("#list-of-sub ul li").on("click", function () {
          if ($("#list-of-sub").hasClass("open-types")) {
            $(".SubstrateType1 .size-block").removeClass("selected-size-block");
            $(document).find("#list-of-sub ul li").removeClass("altSubstratItem");
            $(this).addClass("altSubstratItem");
            passSubstrateType1($(".altSubstratItem").attr("data-substratetype1-val"));
            paperWeightComp($(".altSubstratItem").attr("data-substratetype1-val"), recomPaperTypeBlock);
            $("#alt-substrat span").html($(".altSubstratItem").attr("data-substratetype1-val"));
            $("#alt-substrat p").html($(".altSubstratItem").attr("data-shortdesc"));
            $("#alt-substrat img").attr("src", $(".altSubstratItem").attr("data-asset"));
            console.log($(".altSubstratItem").attr("data-substratetype1-val"));
          }
        });
        $("#list-of-sub ul li").hover(function () {
          if ($("#list-of-sub").hasClass("open-types")) {
            $(document).find("#list-of-sub ul li").removeClass("altSubstratItemHover");
            $(this).addClass("altSubstratItemHover");
            //passSubstrateType1($(".altSubstratItemHover").attr("data-substratetype1-val"));
            $("#alt-substrat span").html($(".altSubstratItemHover").attr("data-substratetype1-val"));
            $("#alt-substrat p").html($(".altSubstratItemHover").attr("data-shortdesc"));
            $("#alt-substrat img").attr("src", $(".altSubstratItemHover").attr("data-asset"));
          }
        }, function () {
          if ($("#list-of-sub").hasClass("open-types")) {
            $("#alt-substrat span").html($(".altSubstratItem").attr("data-substratetype1-val"));
            $("#alt-substrat p").html($(".altSubstratItem").attr("data-shortdesc"));
            $("#alt-substrat img").attr("src", $(".altSubstratItem").attr("data-asset"));
            $(document).find("#list-of-sub ul li").removeClass("altSubstratItemHover");
          }
        });
      }


      function paperWeightComp(paperSelected, recomType) {
        if ($(".PaperWeight").length) {
          // array exists and is not empty
          var sliderValues = new Array(9);
          sliderValues = [];
          $(".sliderBox").html("");
          $(".sliderBox").removeClass("recomWeightBox");
          var PaperWeightValuesQueryUrl = GlobalApiDomain + "PaperWeight1&queryVal=" + paperSelected;
          var x = httpGet(PaperWeightValuesQueryUrl);
          var obj = JSON.parse(x.response);
          if (obj[0].WEIGHT !== "") {
            for (var i = 0; i < obj.length; i++) {
              sliderValues[i] = obj[i].WEIGHT;
            }
          }
          console.log("This of initial: " + sliderValues);
          generatePWComp(sliderValues, paperSelected, recomType);
        }
      }

      function generatePWComp(sliderValues, paperSelected, recomType) {
        if (paperSelected == recomType) {
          var PaperWeightValuesQueryUrl = GlobalApiDomain + "SubstrateType1Common&queryVal=" + ProductId
          var x = httpGet(PaperWeightValuesQueryUrl);
          var obj = JSON.parse(x.response);
          var recomWeight;
          if (obj[0].SUBFAMILYDES !== "") {
            for (var i = 0; i < obj.length; i++) {
              if (obj[i].DEF === "Y") {
                recomWeight = obj[i].WEIGHTH;
              }
            }
          }

          console.log("this is the rcomWegiht: " + recomWeight);
          console.log("This is index of recom " + sliderValues.indexOf(recomWeight));
          $(".sliderBox").each(function (index) {
            if (sliderValues.indexOf(recomWeight) == index) {
              $(this).addClass("recomWeightBox");
              $(this).html(sliderValues[index] + '<img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Draft/Assets/starRecomWeight.svg" class="recomWeight">');
            }
            else {
              $(this).html(sliderValues[index]);
            }
            $(this).on("click", function () {
              var obj1 = $("#slider").data("roundSlider");
              obj1.setValue(index);
              $(".sliderBox").removeClass("selectedBox");
              $(this).addClass("selectedBox");
            });
          });

        }
        else {
          $(".sliderBox").each(function (index) {
            $(this).html(sliderValues[index]);
            $(this).on("click", function () {
              var obj1 = $("#slider").data("roundSlider");
              obj1.setValue(index);
              $(".sliderBox").removeClass("selectedBox");
              $(this).addClass("selectedBox");
            });
          });
        }
        var fn1 = $.fn.roundSlider.prototype._setProperties;
        $.fn.roundSlider.prototype._setProperties = function () {
          fn1.apply(this);
          var o = this.options, r = o.radius, d = r * 2,
            r1 = r - (o.width / 2) - this._border(true),
            svgNS = "http://www.w3.org/2000/svg";
          this._circum = Math.PI * (r1 * 2);

          var $svg = $(document.createElementNS(svgNS, "svg"));
          $svg.attr({ "height": d, "width": d });

          this.$circle = $(document.createElementNS(svgNS, 'circle')).attr({
            "fill": "transparent", "class": "rs-transition", "cx": r, "cy": r, "r": r1,
            "stroke-width": o.width, "stroke-dasharray": this._circum
          }).appendTo($svg);

          this.$svg_box = $(document.createElement("div")).addClass("rs-transition rs-svg").append($svg).css({
            "height": d, "width": d, "transform-origin": "50% 50%",
            "transform": "rotate(" + (o.startAngle + 180) + "deg)"
          }).appendTo(this.innerContainer);
        }

        var fn2 = $.fn.roundSlider.prototype._changeSliderValue;
        $.fn.roundSlider.prototype._changeSliderValue = function (val, deg) {
          fn2.apply(this, arguments);
          deg = deg - this.options.startAngle;

          if (this._rangeSlider) {
            this.$svg_box.rsRotate(this._handle1.angle + 180);
            deg = this._handle2.angle - this._handle1.angle;
          }
          var pct = (1 - (deg / 360)) * this._circum;
          this.$circle.css({ strokeDashoffset: pct });
        }
        /// ### ---- ### --------------------- ### ---- ### ///

        var fetchSlider = document.getElementById("slider");
        $(fetchSlider).roundSlider({
          sliderType: "min-range",
          editableTooltip: false,
          min: 0,
          max: sliderValues.length - 1,
          radius: 133,
          width: 14,
          value: 6,
          handleSize: "+14",
          handleShape: "dot",
          circleShape: "pie",
          startAngle: 315,
          tooltipFormat: function (e) {
            $(".sliderBox").removeClass("selectedBox");
            var mindex = e.value;
            console.log(mindex);
            document.getElementsByClassName("sliderBox")[mindex].classList.add("selectedBox");
            // Pass weight:
            passPaperWeight(sliderValues[e.value]);
            console.log("this is passed weight!: " + sliderValues[e.value]);
            return "<p class='grams'>גרם </p>" + sliderValues[e.value];
          }
        })
        $(".rs-tooltip-text").html("<p class='grams'>גרם </p>" + sliderValues[$("#slider").data("roundSlider").getValue()]);
        passPaperWeight(sliderValues[$("#slider").data("roundSlider").getValue()]);
        console.log("this is passed weight firsttime!: " + sliderValues[$("#slider").data("roundSlider").getValue()]);

        var x = document.querySelector(".rs-svg svg");
        x.insertAdjacentHTML("afterbegin", '<defs><pattern id="pattern" patternUnits="userSpaceOnUse" width="263" height="226"><image xlink:href="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/slider.svg" x="0" y="0" width="263" height="226"></image></pattern></defs>');

      }

      // ColorSystem1 widget:
      if ($(".ColorMethod").length) {
        var ColorMethodUrl = GlobalApiDomain + "ColorSystemRecommended&queryVal=" + ProductId;
        var x = httpGet(ColorMethodUrl);
        var obj = JSON.parse(x.response);
        var recomColorSystem;
        if (obj[0].ESHK_COLORSYSREC != "") {
          recomColorSystem = obj[0].ESHK_COLORSYSREC;
        }
        console.log("this is recom obj: " + recomColorSystem);
        if (recomColorSystem != "") {
          $(".ColorMethod .half-block[data-color|='" + recomColorSystem + "']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
        }
        $(".ColorMethod .half-block").on("click", function () {
          $(".ColorMethod .half-block").removeClass("selected-size-block");
          $(this).addClass("selected-size-block");
          passSidesAsset($(this).attr("data-color"));
          console.log($(this).attr("data-color"));
        });
      }

      // Corners widget:
      if ($(".Corners").length) {
        var CornersUrl = GlobalApiDomain + "RoundedCornersRecommended&queryVal=" + ProductId;
        var x = httpGet(CornersUrl);
        var obj = JSON.parse(x.response);
        var recomCorners;
        if (obj[0].ESHK_ROUNDEDREC != "") {
          recomCorners = obj[0].ESHK_ROUNDEDREC;
        }
        console.log("this is recom obj: " + recomCorners);
        if (recomCorners != "") {
          $(".Corners .half-block[data-corners|='" + recomCorners + "']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
        }
        $(".Corners .half-block").on("click", function () {
          $(".Corners .half-block").removeClass("selected-size-block");
          $(this).addClass("selected-size-block");
          passCorners($(this).attr("data-corners"));
          console.log($(this).attr("data-corners"));
        });
      }

      // Lamination widget:
      if ($(".Lamination").length) {
        var recomLamination;
        var recomLaminationUrl = GlobalApiDomain + "Lamination1Recommended&queryVal=" + ProductId;
        var x = httpGet(recomLaminationUrl);
        var obj = JSON.parse(x.response);
        if (obj[0].ESHK_LAMINATIONDEF != "") {
          recomLamination = obj[0].ESHK_LAMINATIONDEF;
        }

        var isDoubleSided;
        var recomLaminationUrl = GlobalApiDomain + "IsDoubleSided&queryVal=" + ProductId;
        var x = httpGet(recomLaminationUrl);
        var obj = JSON.parse(x.response);
        if (obj[0].ESHK_ISDOUBLESIDED === "Y") {
          isDoubleSided = true;
        }


        // Lamination block api
        var LaminationValuesUrl = GlobalApiDomain + "Lamination1";
        var x = httpGet(LaminationValuesUrl);
        var obj = JSON.parse(x.response);
        var counterLamSort = 0;
        for (var j = 0; j < obj.length; j++) {
          for (var k = 0; k < obj.length; k++) {
            if (parseInt(obj[k].SORT) == counterLamSort) {
              if (obj[k].TITLE != "") {
                if (isDoubleSided && obj[k].TITLE !== "ללא") {
                  var lamBlock = '<div class="lam-block" data-titleElm="' + obj[k].TITLE + '" data-lam="' + obj[k].PRICELEMDES + '"><span>' + obj[k].TITLE + '</span><div class="doubleSidedBlock"><div data-dsBlock="חד צדדי" class="dsBlock selecteddsBlockGrey">חד-צדדי</div><div data-dsBlock="דו צדדי" class="dsBlock">דו-צדדי</div><img src="' + obj[k].ASSETLOC + '"></div>';
                  $(".Lamination .property-value").append(lamBlock);
                  console.log("entered and loop!");
                }
                else {
                  var lamBlock = '<div class="lam-block" data-titleElm="' + obj[k].TITLE + '" data-lam="' + obj[k].PRICELEMDES + '"><span>' + obj[k].TITLE + '</span><img src="' + obj[k].ASSETLOC + '"></div>';
                  $(".Lamination .property-value").append(lamBlock);
                  console.log("entered and loop!");
                }
              }
              counterLamSort++;
              break;
            }
          }
        }
        console.log("this is recom obj: " + recomLamination);
        if (recomLamination != "") {
          $(".Lamination .lam-block[data-titleElm|='" + recomLamination + "']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
        }


        // Lam implement pass value:
        $(".Lamination .lam-block").on("click", function () {
          $(".Lamination .lam-block").removeClass("selected-size-block");
          $(this).addClass("selected-size-block");
          passLamination($(this).attr("data-lam"));
          console.log($(this).attr("data-lam"));
          if (isDoubleSided) {
            if ($(this).find(".dsBlock").length) {
              $(".selecteddsBlock").addClass("selecteddsBlockGrey");
              $(".selecteddsBlock").removeClass("selecteddsBlock");
              $(this).find(".selecteddsBlockGrey").addClass("selecteddsBlock");
              var getRelevantDS = $(this).find(".selecteddsBlock").attr("data-dsBlock");
              passSideLamination(getRelevantDS);
              console.log("Passed this: " + getRelevantDS);
            }
            else {
              $(".selecteddsBlock").addClass("selecteddsBlockGrey");
              $(".selecteddsBlock").removeClass("selecteddsBlock");
              $(this).find(".selecteddsBlockGrey").addClass("selecteddsBlock");
              passSideLamination("None!");
              console.log("Passed none!!: ");

            }

          }
        });

        $(".Lamination .dsBlock ").on("click", function () {
          $(".selecteddsBlock").addClass("selecteddsBlockGrey");
          $(".selecteddsBlock").removeClass("selecteddsBlock");
          $(".Lamination .lam-block").removeClass("selected-size-block");
          $(this).parents(".lam-block").addClass("selected-size-block");
          passLamination($(this).parents(".lam-block").attr("data-lam"));
          console.log($(this).parents(".lam-block").attr("data-lam"));

          if (!$(this).hasClass("selecteddsBlock")) {
            $(this).parent().find(".dsBlock").removeClass("selecteddsBlock");
            $(this).parent().find(".dsBlock").removeClass("selecteddsBlockGrey");
            $(this).addClass("selecteddsBlock");
            var getRelevantDS = $(this).attr("data-dsBlock");
            passSideLamination(getRelevantDS);
            console.log("Passed this: " + getRelevantDS);

            console.log("fired!!");
            return false;
          }
        });
      }

      // Embellishment1 widget:
      if ($(".Embellishment1").length) {
        // Initial pass null to invisible EMBs:
        passEmbellishment2("NULL");
        passEmbellishment3("NULL");
        passSidesEmbellishment2("NULL");
        passSidesEmbellishment3("NULL");

        var recomEmbellishment;
        var recomEmbellishmentUrl = GlobalApiDomain + "Embellishment1Recommended&queryVal=" + ProductId;
        var x = httpGet(recomEmbellishmentUrl);
        var obj = JSON.parse(x.response);
        if (obj[0].ESHK_IMPROREC != "") {
          recomEmbellishment = obj[0].ESHK_IMPROREC;
        }

        var isDoubleSidedEmb;
        var isDoubleSidedEmbUrl = GlobalApiDomain + "IsDoubleSided&queryVal=" + ProductId;
        var x = httpGet(isDoubleSidedEmbUrl);
        var obj = JSON.parse(x.response);
        if (obj[0].ESHK_ISDOUBLESIDED === "Y") {
          isDoubleSidedEmb = true;
        }


        // Embellishment1 block api
        var EmbValuesUrl = GlobalApiDomain + "EmbellishmentsDes&queryVal=Embellishment";
        var x = httpGet(EmbValuesUrl);
        var obj = JSON.parse(x.response);
        var counterEmbSort = 1;
        for (var j = 0; j < obj.length; j++) {
          for (var k = 0; k < obj.length; k++) {
            if (parseInt(obj[k].SORT) == counterEmbSort) {
              if (obj[k].TITLE != "") {
                console.log("hello world!");
                if (isDoubleSidedEmb && obj[k].TITLE !== "ללא השבחה") {
                  if (obj[k].TITLE === "סקודיקס") {
                    var embBlock = '<div class="size-block emb-block"><span>' + obj[k].TITLE + '</span><p>' + obj[k].DES + '</p><div class="scodixSelect"><select></select></div><div class="doubleSidedBlock"><div data-dsBlock="חד צדדי" class="dsBlock selecteddsBlockGrey">חד-צדדי</div><div data-dsBlock="דו צדדי" class="dsBlock">דו-צדדי</div><img src="' + obj[k].ASSETLOC + '"></div>';
                    $(".Embellishment1 .property-value .EmbellishmentFirst").append(embBlock);
                    console.log("entered and loop DS!");
                  }
                  else if (obj[k].TITLE === "VU סלקטיבי") {
                    var embBlock = '<div class="size-block emb-block"><span>' + obj[k].TITLE + '</span><p>' + obj[k].DES + '</p><div class="uvSelect"><select><option data-embdd="UV סלקטיבי">שטוח</option><option data-embdd="UV סלקטיבי בולט">בולט</option></select></div><div class="doubleSidedBlock"><div data-dsBlock="חד צדדי" class="dsBlock selecteddsBlockGrey">חד-צדדי</div><div data-dsBlock="דו צדדי" class="dsBlock">דו-צדדי</div><img src="' + obj[k].ASSETLOC + '"></div>';
                    $(".Embellishment1 .property-value .EmbellishmentFirst").append(embBlock);
                    console.log("entered and loop DS!");
                  }
                }
                else if (!isDoubleSidedEmb) {
                  if (obj[k].TITLE === "סקודיקס") {
                    var embBlock = '<div class="size-block emb-block"><span>' + obj[k].TITLE + '</span><p>' + obj[k].DES + '</p><div class="scodixSelect"><select></select></div><img src="' + obj[k].ASSETLOC + '"></div>';
                    $(".Embellishment1 .property-value .EmbellishmentFirst").append(embBlock);
                    console.log("entered and loop DS!");
                  }
                  else if (obj[k].TITLE === "VU סלקטיבי") {
                    var embBlock = '<div class="size-block emb-block"><span>' + obj[k].TITLE + '</span><p>' + obj[k].DES + '</p><div class="uvSelect"><select><option data-embdd="UV סלקטיבי">שטוח</option><option data-embdd="UV סלקטיבי בולט">בולט</option></select></div><img src="' + obj[k].ASSETLOC + '"></div>';
                    $(".Embellishment1 .property-value .EmbellishmentFirst").append(embBlock);
                    console.log("entered and loop DS!");
                  }
                  else {
                    var embBlock = '<div class="size-block emb-block"><span>' + obj[k].TITLE + '</span><p>' + obj[k].DES + '</p><img src="' + obj[k].ASSETLOC + '"></div>';
                    $(".Embellishment1 .property-value .EmbellishmentFirst").append(embBlock);
                    console.log("entered and loop no!");
                  }
                }
                else {
                  var embBlock = '<div class="size-block emb-block"><span>' + obj[k].TITLE + '</span><p>' + obj[k].DES + '</p><img src="' + obj[k].ASSETLOC + '"></div>';
                  $(".Embellishment1 .property-value .EmbellishmentFirst").append(embBlock);
                  console.log("entered and loop no!");
                }
              }
              counterEmbSort++;
              break;
            }
          }
        }
        console.log("this is recom obj: " + recomEmbellishment);
        if (recomEmbellishment != "") {
          $(".emb-block span:contains('" + recomEmbellishment + "')").parent().prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');
          console.log("Hello world!");
          //$(".Embellishment1 .lam-block[data-titleElm|='"+recomLamination+"']").prepend('<img class="recom-img" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/recommended.svg">');			
        }

        // Load scodix list vals:
        var EmbValuesUrl = GlobalApiDomain + "EmbellishmentsScodix";
        var x = httpGet(EmbValuesUrl);
        var obj = JSON.parse(x.response);
        var counterEmbScodixSort = 0;
        for (var s = 0; s < obj.length; s++) {
          for (var z = 0; z < obj.length; z++) {
            if (parseInt(obj[z].SORT) == counterEmbScodixSort) {
              if (obj[z].AVAILABLE === "Y") {
                $(".EmbellishmentFirst .scodixSelect select").append("<option data-embdd='" + obj[z].IMPROVEDES + "'>" + obj[z].PORTALDES + "</option>");
              }
              counterEmbScodixSort++;
            }
          }
        }


        // Lam implement pass value:
        $(document).on('click', '.emb-block', function () {
          $(this).parent().find(".emb-block").removeClass("selected-size-block");
          $(this).parent().find(".emb-block select").removeClass("selecteEmbDD");
          $(this).find("select").addClass("selecteEmbDD");
          $(this).addClass("selected-size-block");
          //passLamination($(this).attr("data-lam"));
          //console.log($(this).attr("data-lam"));
          if ($(this).parent().parent().hasClass("Embellishment2")) {
            if ($(this).find("select").length) {
              passEmbellishment2($(this).find("select option:selected").attr("data-embdd"));
              console.log("this is of emb2 embb: " + $(this).find("select option:selected").attr("data-embdd"));
            }
            else {
              passEmbellishment2("ללא");
              console.log("this is of emb2 embb: ללא");
            }
          }
          else if ($(this).parent().parent().hasClass("Embellishment3")) {
            if ($(this).find("select").length) {
              passEmbellishment3($(this).find("select option:selected").attr("data-embdd"));
              console.log("this is of emb3 embb: " + $(this).find("select option:selected").attr("data-embdd"));
            }
            else {
              passEmbellishment3("ללא");
              console.log("this is of emb2 embb: ללא");
            }
          }
          else {
            if ($(this).find("select").length) {
              passEmbellishment1($(this).find("select option:selected").attr("data-embdd"));
              console.log("this is of emb1 embb: " + $(this).find("select option:selected").attr("data-embdd"));
            }
            else {
              passEmbellishment1("ללא");
              console.log("this is of emb1 embb: ללא");
            }
          }

          if (isDoubleSided) {
            if ($(this).find(".dsBlock").length) {
              $(this).parent().find(".selecteddsBlock").addClass("selecteddsBlockGrey");
              $(this).parent().find(".selecteddsBlock").removeClass("selecteddsBlock");
              $(this).find(".selecteddsBlockGrey").addClass("selecteddsBlock");
              var getRelevantDS = $(this).find(".selecteddsBlock").attr("data-dsBlock");
              //passSideLamination(getRelevantDS);
              if ($(this).parent().parent().hasClass("Embellishment2")) {
                passSidesEmbellishment2(getRelevantDS);
                console.log("this is of emb2 pass: " + getRelevantDS);
              }
              else if ($(this).parent().parent().hasClass("Embellishment3")) {
                passSidesEmbellishment3(getRelevantDS);
                console.log("this is of emb3 pass: " + getRelevantDS);

              }
              else {
                passSidesEmbellishment1(getRelevantDS);
                console.log("this is of emb1 pass: " + getRelevantDS);
              }
              console.log("Passed this: " + getRelevantDS);
            }
            else {
              $(this).parent().find(".selecteddsBlock").addClass("selecteddsBlockGrey");
              $(this).parent().find(".selecteddsBlock").removeClass("selecteddsBlock");
              $(this).find(".selecteddsBlockGrey").addClass("selecteddsBlock");
              if ($(this).parent().parent().hasClass("Embellishment2")) {
                passSidesEmbellishment2("NULL");
                console.log("this is of emb2 pass");
              }
              else if ($(this).parent().parent().hasClass("Embellishment3")) {
                passSidesEmbellishment3("NULL");
                console.log("this is of emb3 pass");
              }
              else {
                passSidesEmbellishment1("NULL");
                console.log("this is of emb1 pass");
              }
            }

          }
        });


        $(document).on('click', '.dsBlock', function () {
          $(this).parent().find(".selecteddsBlock").addClass("selecteddsBlockGrey");
          $(this).parent().find(".selecteddsBlock").removeClass("selecteddsBlock");
          $(this).parent().parent().parent().find(".emb-block").removeClass("selected-size-block");
          $(this).parents(".emb-block").addClass("selected-size-block");
          $(this).parent().parent().parent().find(".emb-block select").removeClass("selecteEmbDD");
          $(this).parent().parent().find("select").addClass("selecteEmbDD");


          //passLamination($(this).parents(".lam-block").attr("data-lam"));
          //console.log($(this).parents(".lam-block").attr("data-lam"));

          if (!$(this).hasClass("selecteddsBlock")) {
            //$(this).parent().parent().parent().parent().find(".emb-block .selecteddsBlock").addClass("selecteddsBlockGrey");					
            //$(this).parent().parent().parent().parent().find(".emb-block .selecteddsBlock").removeClass("selecteddsBlock");
            $(this).parent().parent().find(".dsBlock").removeClass("selecteddsBlock");
            $(this).parent().parent().find(".dsBlock").removeClass("selecteddsBlockGrey");
            $(this).parent().parent().parent().find(".selecteddsBlock").addClass("selecteddsBlockGrey");
            $(this).parent().parent().parent().find(".selecteddsBlock").removeClass("selecteddsBlock");

            $(this).addClass("selecteddsBlock");
            //$(this).addClass("selecteddsBlockGrey");




            var getRelevantDS = $(this).attr("data-dsBlock");
            //passSideLamination(getRelevantDS);
            if ($(this).parent().parent().parent().parent().hasClass("Embellishment2")) {
              passSidesEmbellishment2(getRelevantDS);
              console.log("this is of emb2 pass: " + getRelevantDS);
              passEmbellishment2($(this).parent().parent().parent().find("select option:selected").attr("data-embdd"));
              console.log("Passed emb usuing DS OF EMB2 : " + $(this).parent().parent().find("select option:selected").attr("data-embdd"));
            }
            else if ($(this).parent().parent().parent().parent().hasClass("Embellishment3")) {
              passSidesEmbellishment3(getRelevantDS);
              console.log("this is of emb3 pass: " + getRelevantDS);
              passEmbellishment3($(this).parent().parent().parent().find("select option:selected").attr("data-embdd"));
              console.log("Passed emb usuing DS OF EMB3 : " + $(this).parent().parent().find("select option:selected").attr("data-embdd"));

            }
            else {
              passSidesEmbellishment1(getRelevantDS);
              console.log("this is of emb1 pass: " + getRelevantDS);
              passEmbellishment1($(this).parent().parent().parent().find("select option:selected").attr("data-embdd"));
              console.log("Passed emb usuing DS OF EMB1 : " + $(this).parent().parent().find("select option:selected").attr("data-embdd"));

            }


            console.log("fired!!");
            return false;
          }
        });

        // Delete EMB
        $(document).on('click', '.deleteEmb', function () {

          // Detect second or third EMB
          if ($(this).parent().parent().hasClass("Embellishment2")) {
            console.log("clicked on delete of 2");
            if ($(".Embellishment3").is(":visible")) {
              console.log("Forbidden");
            }
            else {
              console.log("Its allowed since third is not visible");
              $(".Embellishment2").hide();
              passEmbellishment2("NULL");
              passSidesEmbellishment2("NULL");

            }
          }
          else {
            if ($(".Embellishment2").is(":visible")) {
              console.log("Its allowed since second is visible");
              $(".Embellishment3").hide();
              passEmbellishment3("NULL");
              passSidesEmbellishment3("NULL");
            }
            else {
              console.log("Forbidden");
            }
          }

        });

        // Add EMB
        $(document).on('click', '#addEmb', function () {
          if (!$(".Embellishment2").is(":visible")) {
            $(".Embellishment2").show();
          }
          else if (!$(".Embellishment3").is(":visible")) {
            $(".Embellishment3").show();
          }
          else {
            console.log("No more embs, stop..");
          }

        });

        // Create additional embs
        var Cloned = $(".Embellishment1 .property-value").clone().html();
        $(".Embellishment1 .property-value").append('<div class="AddEmb Embellishment2"><span><div class="deleteEmb"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/deleteEmb.svg"></div> השבחה שנייה</span>' + Cloned + '</div>');
        $(".Embellishment1 .property-value").append('<div class="AddEmb Embellishment3"><span><div class="deleteEmb"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/deleteEmb.svg"></div> השבחה שלישית</span>' + Cloned + '</div>');
        $(".AddEmb .recom-img").remove();
        $(".Embellishment1 .property-value").append('<div id="addEmb"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/plusEMB.svg">הוספת שכבת השבחה</div>');

      }

      // Copies widget:
      if ($(".Copies").length) {
        // Load scodix list vals:
        var copiesValuesUrl = GlobalApiDomain + "Copies&queryVal=" + ProductId;
        var recomCopies;
        var copiesSliderValues = new Array();
        var x = httpGet(copiesValuesUrl);
        var obj = JSON.parse(x.response);
        var CopiesLast = obj.length - 1;
        for (var s = 0; s < obj.length; s++) {
          copiesSliderValues[s] = parseInt(obj[s].QNM);
          if (obj[s].QF === "Y") {
            recomCopies = parseInt(obj[s].QNM);
          }
        }
        console.log(copiesSliderValues[0]);
        console.log(copiesSliderValues[CopiesLast]);
        copiesSliderValues.sort((a, b) => a - b); // For ascending sort

        $("#CopiesSlider").slider({
          range: "min",
          value: recomCopies,
          min: copiesSliderValues[0],
          max: copiesSliderValues[CopiesLast],
          slide: function (event, ui) {
            $("#editCopiesAmount input").val(ui.value);
            $("#amount").val("$" + ui.value);
            passCopies(ui.value);
            console.log("passed copies: " + ui.value);
          }
        });
        $("#amount").val("$" + $("#slider-range-min").slider("value"));
        $("#CopiesSlider .ui-slider-handle").append("<div id='editCopiesAmount'><span><label for='editCopies'><img src='/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/copiesEditBtn.svg'></label></span><input id='editCopies' type='number' value='" + recomCopies + "' min='" + copiesSliderValues[0] + "' max='" + copiesSliderValues[CopiesLast] + "'onChange='if(this.value>" + copiesSliderValues[CopiesLast] + "){this.value=" + copiesSliderValues[CopiesLast] + ";}else if(this.value<" + copiesSliderValues[0] + "){this.value=" + copiesSliderValues[0] + ";}'/></div>");
        $(document).on("change", "#editCopiesAmount input", function () {
          $("#CopiesSlider").slider("option", "value", $(this).val());
          passCopies($(this).val());
          console.log("passed copies: " + $(this).val());

        });
        $("#editCopiesAmount span").on("click", function () {
          $("#editCopiesAmount input").focus();
          $("#CopiesSlider").slider("option", "value", $("#editCopiesAmount input").val());
          passCopies($("#editCopiesAmount input").val());
          console.log("passed copies: " + $("#editCopiesAmount input").val());

          console.log("go focuss..");
          //return false;
        });

        for (var s = 0; s < copiesSliderValues.length; s++) {
          if (s == 0) {
            var positionVal = (copiesSliderValues[s] / copiesSliderValues[CopiesLast]) * -300;
          }
          else if (s == CopiesLast) {
            var positionVal = (copiesSliderValues[s] / copiesSliderValues[CopiesLast]) * 93;
          }
          else if (s == 1) {
            var positionVal = (copiesSliderValues[s] / copiesSliderValues[CopiesLast]) * 50;
          }
          else {
            var positionVal = (copiesSliderValues[s] / copiesSliderValues[CopiesLast]) * 90;
          }
          $("#insideCopies").append('<div class="commonQuant" style="left:' + positionVal + '%;">' + copiesSliderValues[s] + '<span></span></div>');
        }


      }

      if ($(".InfoPopup").length) {
        $(".InfoPopup").parent().parent().addClass("UploadFiles");
        $(".UploadFiles").prepend('<img class="rightTitleImg" src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/nav-selected.svg">');
        $(".UploadFiles .FormLabel").html('העלאת קובץ גרפיקה <div class="info-product"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/more-info-product.svg"><div class="info-proudct-box" style="display: none;">לורם איפסום דולור סיט אמט, קונסקטורר אדיפיסינג אלית לורם איפסום דולור סיט אמט,קונסקטורר אדיפיסינג אלית. סת אלמנקום ניסי נון ניבאה.</div></div>');
        $(".UploadFiles .info-product").hover(function () {
          $(this).find(".info-proudct-box").show();
        }, function () {
          $(this).find(".info-proudct-box").hide();
        });
        $('<span id="graphicsTitle">גרפיקת כרטיס</span>').insertBefore(".fileAttachDropFilesHere");
        $('<span id="supportedTtitle">יש לעלות קובץ עם 2 דפים בגדלים: 5.5x9.5, 5.5x9.5 ס״מ</span>').insertAfter(".UploadFiles .FormLabel");
        $(".fileAttachDropFilesHere a").html('<span id="blueFile"> העלה קובץ </span> או גרור אותו לכאן</span>');
        $('<div id="fileuploadStatus"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/pdfFile.svg"><div id="fileUpload"><span>לא נבחר קובץ</span><div id="progressBarFile"></div></div><div id="removeFile"><img src="/ustoreThemeCustomizations/7e3cba3a-908c-4145-a418-69de15962725/Published/Assets/removeFile.svg"></div></div>').insertAfter('.fileAttachDropFilesHere');

        $(document).on('DOMSubtreeModified', ".FileAttachmentList", function () {
          console.log("did change!@!!");
          setTimeout(function () {
            if ($('#dvmValidationSummary ul li').length >= 1 || $('.FileAttachmentList li').length == 0) {
              console.log("error donot continue");
              $('.fileAttachDropFilesHere').removeClass("checkOn");
              //$('#ctl00_cphMainContent_ucDialCustomization_btnUpdateThumbnails').click();
              $("#fileUpload span").html("לא נבחר קובץ");
              $("#progressBarFile").removeClass("completeBar");

            }
            else {
              $('.fileAttachDropFilesHere').addClass("checkOn");
              console.log("success refresh");
              var getText = $(".FileAttachmentList li a").html();
              $("#fileUpload span").html(getText);
              $("#progressBarFile").addClass("completeBar");
            }
          }, 400);
          // code here
          /*
            $('#dvmValidationSummary ul li').each(function () {
              if ($(this).html().indexOf("אנא הכנס ערך בשדה") >= 0) {
                $(this).html("נא לעלות קובץ על מנת להמשיך");
                $('.fileAttachDropFilesHere').css({ 'border': '3px solid red', 'border-radius': '5px' });
              }
              else {
                $('.fileAttachDropFilesHere').css({ 'border': '0', 'border-radius': '0' });
              }
            });
          */

        });
        $(document).on('click', "#removeFile", function () {
          var x = $(".fileAttachDelete").click();
          $("#fileUpload span").html("לא נבחר קובץ");
          $("#progressBarFile").removeClass("completeBar");

        });
      }


    }
  });
</script>